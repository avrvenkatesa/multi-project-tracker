<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Multi-Project Tracker</title>
        <script src="https://cdn.tailwindcss.com"></script>
        <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    </head>
    <body class="bg-gray-50">
        <div id="app">
            <!-- Header -->
            <header class="bg-blue-600 text-white shadow-lg">
                <div class="max-w-7xl mx-auto px-4 py-6">
                    <div class="flex justify-between items-center">
                        <div>
                            <h1 class="text-3xl font-bold">Multi-Project Tracker</h1>
                            <p class="text-blue-100 mt-2">
                                AI-powered issue and action item tracking
                            </p>
                        </div>
                        
                        <!-- Auth Section -->
                        <div class="flex items-center space-x-4">
                            <!-- Logged Out State -->
                            <div id="loggedOutState" class="hidden flex space-x-2">
                                <button id="login-btn" class="bg-white text-blue-600 px-4 py-2 rounded-lg hover:bg-blue-50">
                                    Login
                                </button>
                                <button id="register-btn" class="bg-blue-700 text-white px-4 py-2 rounded-lg hover:bg-blue-800">
                                    Register
                                </button>
                            </div>
                            
                            <!-- Logged In State -->
                            <div id="loggedInState" class="hidden flex items-center gap-4">
                                <!-- Mention Notifications Bell -->
                                <div class="relative">
                                    <button 
                                        id="mention-bell-btn"
                                        class="relative p-2 text-white hover:bg-blue-700 rounded-lg transition">
                                        <span class="text-2xl">🔔</span>
                                        <span id="mention-count-badge" class="hidden absolute top-0 right-0 bg-red-500 text-white text-xs rounded-full h-5 w-5 flex items-center justify-center font-bold">0</span>
                                    </button>
                                    
                                    <!-- Notifications Dropdown -->
                                    <div id="mention-notifications-dropdown" class="hidden absolute right-0 mt-2 w-96 bg-white border border-gray-200 rounded-lg shadow-xl z-50 max-h-96 overflow-y-auto">
                                        <div class="p-4 border-b border-gray-200 flex justify-between items-center">
                                            <h3 class="font-semibold text-gray-900">Mentions</h3>
                                            <button id="mark-all-read-btn" class="text-sm text-indigo-600 hover:text-indigo-800">
                                                Mark all read
                                            </button>
                                        </div>
                                        <div id="mention-notifications-list">
                                            <!-- Notifications will be populated here -->
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- My Invitations - Envelope Icon -->
                                <a href="invitations.html" class="relative p-2 hover:bg-blue-700 rounded-lg transition" title="My Invitations">
                                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"></path>
                                    </svg>
                                    <span id="invitation-count-badge" class="hidden absolute top-0 right-0 bg-red-500 text-white text-xs rounded-full h-5 w-5 flex items-center justify-center font-bold">0</span>
                                </a>
                                
                                <!-- User Info - Stacked Vertically (hidden on mobile) -->
                                <div class="hidden md:flex flex-col items-end text-right">
                                    <span id="userName" class="font-semibold text-sm"></span>
                                    <span id="userRole" class="bg-blue-800 px-2 py-0.5 rounded text-xs"></span>
                                    <span id="userEmail" class="text-xs opacity-90"></span>
                                </div>
                                
                                <!-- Logout Icon Button -->
                                <button id="logout-btn" class="p-2 hover:bg-blue-700 rounded-lg transition" title="Logout">
                                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"></path>
                                    </svg>
                                </button>
                                
                                <!-- Hamburger Menu (Far Right) -->
                                <div class="relative">
                                    <button id="hamburger-btn" class="p-2 hover:bg-blue-700 rounded-lg transition">
                                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
                                        </svg>
                                    </button>
                                    
                                    <!-- Dropdown Menu -->
                                    <div id="hamburger-dropdown" class="hidden absolute right-0 mt-2 w-48 bg-white rounded-lg shadow-xl py-2 z-50">
                                        <!-- Mobile: Show user info first -->
                                        <div class="md:hidden border-b px-4 py-3 mb-2">
                                            <p id="mobile-userName" class="font-semibold text-gray-800"></p>
                                            <p id="mobile-userRole" class="text-xs text-gray-600"></p>
                                            <p id="mobile-userEmail" class="text-xs text-gray-600"></p>
                                        </div>
                                        
                                        <a href="notification-settings.html" class="block px-4 py-2 text-gray-800 hover:bg-gray-100">
                                            <svg class="w-4 h-4 inline mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"></path>
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                                            </svg>
                                            Settings
                                        </a>
                                        <a href="help.html" class="block px-4 py-2 text-gray-800 hover:bg-gray-100">
                                            <svg class="w-4 h-4 inline mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                            </svg>
                                            Help
                                        </a>
                                    </div>
                                </div>
                                
                                <button id="user-management-link" class="hidden bg-blue-700 text-white px-4 py-2 rounded-lg hover:bg-blue-800">
                                    Manage Users
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </header>

            <!-- Loading Indicator -->
            <div id="loading-indicator" class="hidden fixed top-20 left-1/2 transform -translate-x-1/2 z-50">
                <div class="bg-blue-600 text-white px-6 py-3 rounded-lg shadow-lg flex items-center gap-3">
                    <svg class="animate-spin h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                    </svg>
                    <span class="font-medium">Loading...</span>
                </div>
            </div>

            <!-- Main Content -->
            <main class="max-w-7xl mx-auto px-4 py-8">
                <!-- Project Selection -->
                <div class="mb-8">
                    <div class="flex justify-between items-center mb-4">
                        <h2 class="text-2xl font-semibold text-gray-800">
                            Projects
                        </h2>
                        <div class="flex gap-3">
                            <button
                                id="viewArchivedBtn"
                                class="hidden bg-gray-600 text-white px-4 py-2 rounded-lg hover:bg-gray-700 flex items-center gap-2"
                            >
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
                                          d="M5 8h14M5 8a2 2 0 110-4h14a2 2 0 110 4M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8m-9 4h4"></path>
                                </svg>
                                View Archived
                            </button>
                            <button
                                id="create-project-btn"
                                data-create-project
                                class="hidden bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700"
                            >
                                + New Project
                            </button>
                        </div>
                    </div>
                    <div
                        id="projects-list"
                        class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"
                    >
                        <!-- Projects will be loaded here -->
                    </div>
                </div>

                <!-- Current Project View -->
                <div id="project-view" class="hidden">
                    <div class="bg-white rounded-lg shadow-md p-6 mb-6">
                        <div class="flex justify-between items-center mb-4">
                            <div class="flex items-center gap-4">
                                <h3
                                    id="current-project-name"
                                    class="text-xl font-semibold"
                                ></h3>
                                
                                <!-- View Dropdown -->
                                <div class="relative">
                                    <button
                                        id="view-dropdown-btn"
                                        class="bg-purple-600 text-white px-4 py-2 rounded-lg hover:bg-purple-700 flex items-center gap-2 transition-all"
                                        aria-haspopup="true"
                                        aria-expanded="false"
                                        aria-controls="view-dropdown-menu"
                                    >
                                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/>
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"/>
                                        </svg>
                                        View
                                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
                                        </svg>
                                    </button>
                                    
                                    <!-- View Dropdown Menu -->
                                    <div id="view-dropdown-menu" role="menu" class="hidden absolute left-0 mt-2 w-56 bg-white rounded-lg shadow-xl py-2 z-50 border border-gray-200">
                                        <button id="dashboard-btn" role="menuitem" class="w-full text-left px-4 py-2 hover:bg-purple-50 flex items-center gap-3 transition-colors">
                                            <svg class="w-5 h-5 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"/>
                                            </svg>
                                            <span class="text-gray-700">Dashboard</span>
                                        </button>
                                        <button id="view-checklists-btn" role="menuitem" class="w-full text-left px-4 py-2 hover:bg-blue-50 flex items-center gap-3 transition-colors">
                                            <svg class="w-5 h-5 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01"/>
                                            </svg>
                                            <span class="text-gray-700">Checklists</span>
                                        </button>
                                        <button id="view-templates-btn" role="menuitem" class="w-full text-left px-4 py-2 hover:bg-indigo-50 flex items-center gap-3 transition-colors">
                                            <svg class="w-5 h-5 text-indigo-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 5a2 2 0 012-2h10a2 2 0 012 2v16l-7-3.5L5 21V5z"/>
                                            </svg>
                                            <span class="text-gray-700">Templates</span>
                                        </button>
                                        <button id="view-tags-btn" role="menuitem" class="w-full text-left px-4 py-2 hover:bg-teal-50 flex items-center gap-3 transition-colors">
                                            <svg class="w-5 h-5 text-teal-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z"/>
                                            </svg>
                                            <span class="text-gray-700">Tags</span>
                                        </button>
                                        <button id="view-risks-btn" role="menuitem" class="w-full text-left px-4 py-2 hover:bg-orange-50 flex items-center gap-3 transition-colors">
                                            <svg class="w-5 h-5 text-orange-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"/>
                                            </svg>
                                            <span class="text-gray-700">Risks</span>
                                        </button>
                                    </div>
                                </div>
                                
                                <!-- AI Analysis Button -->
                                <button 
                                    id="ai-analysis-btn"
                                    data-action="open-ai-analysis"
                                    class="px-4 py-2 bg-gradient-to-r from-purple-600 to-blue-600 text-white rounded-lg hover:from-purple-700 hover:to-blue-700 flex items-center gap-2 shadow-md transition-all"
                                    title="AI Analysis"
                                >
                                    <span>⚡</span>
                                    <span>AI Analysis</span>
                                </button>
                                
                                <!-- Transcripts Button -->
                                <button 
                                    id="transcripts-btn"
                                    data-action="open-transcripts"
                                    class="px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 flex items-center gap-2 transition-all"
                                    title="Meeting Transcripts"
                                >
                                    <span>🎙️</span>
                                    <span>Transcripts</span>
                                </button>
                                
                                <!-- View Mode Toggle -->
                                <div class="flex items-center gap-2 bg-gray-100 rounded-lg p-1">
                                    <button 
                                        id="kanban-view-btn"
                                        class="px-3 py-1.5 bg-white text-gray-700 rounded-md shadow-sm flex items-center gap-1.5 transition-all font-medium text-sm"
                                        title="Kanban View"
                                    >
                                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 17V7m0 10a2 2 0 01-2 2H5a2 2 0 01-2-2V7a2 2 0 012-2h2a2 2 0 012 2m0 10a2 2 0 002 2h2a2 2 0 002-2M9 7a2 2 0 012-2h2a2 2 0 012 2m0 10V7m0 10a2 2 0 002 2h2a2 2 0 002-2V7a2 2 0 00-2-2h-2a2 2 0 00-2 2"/>
                                        </svg>
                                        Kanban
                                    </button>
                                    <button 
                                        id="table-view-btn"
                                        class="px-3 py-1.5 text-gray-600 rounded-md flex items-center gap-1.5 transition-all font-medium text-sm hover:bg-gray-200"
                                        title="Table View"
                                    >
                                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 10h18M3 14h18m-9-4v8m-7 0h14a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"/>
                                        </svg>
                                        Table
                                    </button>
                                </div>
                            </div>
                            
                            <!-- Create Dropdown on right -->
                            <div class="relative">
                                <button
                                    id="create-dropdown-btn"
                                    data-requires-write
                                    class="bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 flex items-center gap-2"
                                    aria-haspopup="true"
                                    aria-expanded="false"
                                    aria-controls="create-dropdown-menu"
                                >
                                    <span class="text-lg">+</span>
                                    Create
                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
                                    </svg>
                                </button>
                                
                                <!-- Create Dropdown Menu -->
                                <div id="create-dropdown-menu" role="menu" class="hidden absolute right-0 mt-2 w-48 bg-white rounded-lg shadow-xl py-2 z-50 border border-gray-200">
                                    <button id="create-issue-btn" role="menuitem" data-requires-write class="w-full text-left px-4 py-2 hover:bg-green-50 flex items-center gap-3 transition-colors">
                                        <svg class="w-5 h-5 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v3m0 0v3m0-3h3m-3 0H9m12 0a9 9 0 11-18 0 9 9 0 0118 0z"/>
                                        </svg>
                                        <span class="text-gray-700">Issue</span>
                                    </button>
                                    <button id="create-action-item-btn" role="menuitem" data-requires-write class="w-full text-left px-4 py-2 hover:bg-purple-50 flex items-center gap-3 transition-colors">
                                        <svg class="w-5 h-5 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"/>
                                        </svg>
                                        <span class="text-gray-700">Action Item</span>
                                    </button>
                                </div>
                            </div>
                        </div>

                        <!-- Filters & Search -->
                        <div class="bg-white rounded-lg shadow-md p-4 mb-4">
                            <div class="flex items-center justify-between mb-3">
                                <h4 class="font-semibold text-gray-700">Filters & Search</h4>
                                <button 
                                    id="clear-filters-btn"
                                    class="flex items-center gap-1 text-sm text-blue-600 hover:text-blue-700 font-medium transition-colors">
                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/>
                                    </svg>
                                    Reset to Defaults
                                </button>
                            </div>
                            
                            <!-- Filter Form -->
                            <div class="grid grid-cols-1 md:grid-cols-6 gap-3">
                                <!-- Search -->
                                <div class="md:col-span-2">
                                    <label class="block text-xs font-medium text-gray-600 mb-1">Search</label>
                                    <input 
                                        type="text" 
                                        id="search-input"
                                        placeholder="Search titles and descriptions..."
                                        class="w-full px-3 py-2 border border-gray-300 rounded-md text-sm focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                    />
                                </div>
                                
                                <!-- Type Filter -->
                                <div>
                                    <label class="block text-xs font-medium text-gray-600 mb-1">Type</label>
                                    <select 
                                        id="type-filter"
                                        class="w-full px-3 py-2 border border-gray-300 rounded-md text-sm focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                    >
                                        <option value="">All Types</option>
                                        <option value="issue">Issues Only</option>
                                        <option value="action">Action Items Only</option>
                                    </select>
                                </div>
                                
                                <!-- Status Filter -->
                                <div>
                                    <label class="block text-xs font-medium text-gray-600 mb-1">Status</label>
                                    <select 
                                        id="status-filter"
                                        class="w-full px-3 py-2 border border-gray-300 rounded-md text-sm focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                    >
                                        <option value="">All Statuses</option>
                                        <option value="todo">To Do</option>
                                        <option value="inprogress">In Progress</option>
                                        <option value="blocked">Blocked</option>
                                        <option value="done">Done</option>
                                    </select>
                                </div>
                                
                                <!-- Priority Filter -->
                                <div>
                                    <label class="block text-xs font-medium text-gray-600 mb-1">Priority</label>
                                    <select 
                                        id="priority-filter"
                                        class="w-full px-3 py-2 border border-gray-300 rounded-md text-sm focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                    >
                                        <option value="">All Priorities</option>
                                        <option value="critical">Critical</option>
                                        <option value="high">High</option>
                                        <option value="medium">Medium</option>
                                        <option value="low">Low</option>
                                    </select>
                                </div>
                                
                                <!-- Assignee Filter -->
                                <div>
                                    <label class="block text-xs font-medium text-gray-600 mb-1">Assignee</label>
                                    <select 
                                        id="assignee-filter"
                                        class="w-full px-3 py-2 border border-gray-300 rounded-md text-sm focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                    >
                                        <option value="">All Assignees</option>
                                        <option value="Unassigned">Unassigned</option>
                                        <!-- Dynamic options will be added by JavaScript -->
                                    </select>
                                </div>
                                
                                <!-- Tag Filter -->
                                <div>
                                    <label class="block text-xs font-medium text-gray-600 mb-1">Tag</label>
                                    <select 
                                        id="tag-filter"
                                        class="w-full px-3 py-2 border border-gray-300 rounded-md text-sm focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                    >
                                        <option value="">All Tags</option>
                                        <!-- Dynamic options will be added by JavaScript -->
                                    </select>
                                </div>
                            </div>
                            
                            <!-- Additional Filters Row -->
                            <div class="mt-3 pt-3 border-t border-gray-200">
                                <label class="flex items-center gap-2 cursor-pointer">
                                    <input 
                                        type="checkbox" 
                                        id="has-planning-filter"
                                        class="w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-2 focus:ring-blue-500"
                                    />
                                    <span class="text-sm font-medium text-gray-700">📊 Has Planning Estimate</span>
                                </label>
                            </div>
                            
                            <!-- Active Filters Display -->
                            <div id="active-filters" class="mt-3 flex flex-wrap gap-2 hidden">
                                <!-- Filter badges will be added here dynamically -->
                            </div>
                            
                            <!-- Results Count -->
                            <div id="results-count" class="mt-2 text-sm text-gray-600 hidden">
                                <!-- Count will be displayed here -->
                            </div>
                            
                            <!-- Export Actions -->
                            <div class="mt-3 flex items-center gap-2 border-t pt-3">
                                <span class="text-xs font-medium text-gray-600">Export:</span>
                                <button 
                                    id="copy-clipboard-btn"
                                    class="text-xs px-3 py-1.5 bg-blue-50 text-blue-700 rounded hover:bg-blue-100 transition-colors border border-blue-300 flex items-center gap-1.5"
                                    title="Copy to clipboard (paste into Excel/Google Sheets)"
                                >
                                    <svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"/>
                                    </svg>
                                    <span id="copy-btn-text">Copy to Clipboard</span>
                                </button>
                            </div>
                        </div>

                        <!-- Bulk Actions Bar -->
                        <div id="bulkActionsBar" class="bulk-actions-bar mb-4" style="display: none;">
                            <div class="flex items-center gap-4 p-4 bg-blue-50 border border-blue-200 rounded-lg">
                                <input type="checkbox" id="selectAllItems" class="cursor-pointer w-4 h-4" />
                                <label for="selectAllItems" class="font-medium text-gray-700">Select All</label>
                                
                                <span id="selectedCount" class="text-gray-600 font-medium">0 selected</span>
                                
                                <button 
                                    id="bulkGenerateEstimatesBtn" 
                                    class="ml-auto px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 disabled:bg-gray-400 transition-colors"
                                    disabled
                                >
                                    🤖 Generate AI Estimates
                                </button>
                                
                                <button 
                                    id="bulkApplyTemplateBtn" 
                                    class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:bg-gray-400 transition-colors"
                                    disabled
                                >
                                    Apply Template to Selected
                                </button>
                                
                                <button 
                                    id="clearSelectionBtn" 
                                    class="px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition-colors"
                                >
                                    Clear
                                </button>
                            </div>
                        </div>

                        <!-- Kanban Board -->
                        <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                            <div class="bg-gray-100 rounded-lg p-4">
                                <div class="flex flex-nowrap items-center justify-between gap-2 mb-3">
                                    <h4 class="font-semibold text-gray-700 whitespace-nowrap">
                                        To Do <span id="todo-count" class="text-sm text-gray-500">(0)</span>
                                    </h4>
                                    <select class="column-sort-select flex-shrink-0 text-xs px-2 py-1 border border-gray-300 rounded" data-column="todo">
                                        <option value="due-overdue-first">Overdue First</option>
                                        <option value="due-earliest">Earliest</option>
                                        <option value="due-latest">Latest</option>
                                        <option value="priority">Priority</option>
                                        <option value="created-desc">Recent</option>
                                        <option value="updated-desc">Updated</option>
                                        <option value="manual">Manual</option>
                                        <option value="priority-due-date">Priority+Due Date</option>
                                        <option value="overdue-priority">Overdue+Priority</option>
                                        <option value="smart-sort">Smart Sort</option>
                                    </select>
                                </div>
                                <div id="todo-column" class="space-y-2">
                                    <!-- Items will be loaded here -->
                                </div>
                            </div>
                            <div class="bg-blue-50 rounded-lg p-4">
                                <div class="flex flex-nowrap items-center justify-between gap-2 mb-3">
                                    <h4 class="font-semibold text-blue-700 whitespace-nowrap">
                                        In Progress <span id="inprogress-count" class="text-sm text-blue-500">(0)</span>
                                    </h4>
                                    <select class="column-sort-select flex-shrink-0 text-xs px-2 py-1 border border-gray-300 rounded" data-column="inprogress">
                                        <option value="due-overdue-first">Overdue First</option>
                                        <option value="due-earliest">Earliest</option>
                                        <option value="due-latest">Latest</option>
                                        <option value="priority">Priority</option>
                                        <option value="created-desc">Recent</option>
                                        <option value="updated-desc">Updated</option>
                                        <option value="manual">Manual</option>
                                        <option value="priority-due-date">Priority+Due Date</option>
                                        <option value="overdue-priority">Overdue+Priority</option>
                                        <option value="smart-sort">Smart Sort</option>
                                    </select>
                                </div>
                                <div id="inprogress-column" class="space-y-2">
                                    <!-- Items will be loaded here -->
                                </div>
                            </div>
                            <div class="bg-yellow-50 rounded-lg p-4">
                                <div class="flex flex-nowrap items-center justify-between gap-2 mb-3">
                                    <h4 class="font-semibold text-yellow-700 whitespace-nowrap">
                                        Blocked <span id="blocked-count" class="text-sm text-yellow-600">(0)</span>
                                    </h4>
                                    <select class="column-sort-select flex-shrink-0 text-xs px-2 py-1 border border-gray-300 rounded" data-column="blocked">
                                        <option value="due-overdue-first">Overdue First</option>
                                        <option value="due-earliest">Earliest</option>
                                        <option value="due-latest">Latest</option>
                                        <option value="priority">Priority</option>
                                        <option value="created-desc">Recent</option>
                                        <option value="updated-desc">Updated</option>
                                        <option value="manual">Manual</option>
                                        <option value="priority-due-date">Priority+Due Date</option>
                                        <option value="overdue-priority">Overdue+Priority</option>
                                        <option value="smart-sort">Smart Sort</option>
                                    </select>
                                </div>
                                <div id="blocked-column" class="space-y-2">
                                    <!-- Items will be loaded here -->
                                </div>
                            </div>
                            <div class="bg-green-50 rounded-lg p-4">
                                <div class="flex flex-nowrap items-center justify-between gap-2 mb-3">
                                    <h4 class="font-semibold text-green-700 whitespace-nowrap">
                                        Done <span id="done-count" class="text-sm text-green-600">(0)</span>
                                    </h4>
                                    <select class="column-sort-select flex-shrink-0 text-xs px-2 py-1 border border-gray-300 rounded" data-column="done">
                                        <option value="due-overdue-first">Overdue First</option>
                                        <option value="due-earliest">Earliest</option>
                                        <option value="due-latest">Latest</option>
                                        <option value="priority">Priority</option>
                                        <option value="created-desc">Recent</option>
                                        <option value="updated-desc">Updated</option>
                                        <option value="manual">Manual</option>
                                        <option value="priority-due-date">Priority+Due Date</option>
                                        <option value="overdue-priority">Overdue+Priority</option>
                                        <option value="smart-sort">Smart Sort</option>
                                    </select>
                                </div>
                                <div id="done-column" class="space-y-2">
                                    <!-- Items will be loaded here -->
                                </div>
                            </div>
                        </div>
                        
                        <!-- Table View -->
                        <div id="table-view" class="hidden">
                            <!-- Table Bulk Actions Bar -->
                            <div id="table-bulk-actions-bar" class="mb-4 hidden">
                                <div class="flex items-center gap-4 p-4 bg-blue-50 border border-blue-200 rounded-lg">
                                    <span id="table-selected-count" class="font-medium text-gray-700">0 selected</span>
                                    
                                    <select id="table-bulk-status-select" class="px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                                        <option value="">Change Status...</option>
                                        <option value="todo">To Do</option>
                                        <option value="inprogress">In Progress</option>
                                        <option value="blocked">Blocked</option>
                                        <option value="done">Done</option>
                                    </select>
                                    
                                    <button 
                                        id="table-bulk-status-btn" 
                                        class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:bg-gray-400 transition-colors"
                                        disabled
                                    >
                                        Apply Status
                                    </button>
                                    
                                    <button 
                                        id="table-generate-estimates-btn" 
                                        class="px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 disabled:bg-gray-400 transition-colors"
                                        disabled
                                    >
                                        🤖 Generate AI Estimates
                                    </button>
                                    
                                    <button 
                                        id="table-bulk-delete-btn" 
                                        class="px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors"
                                    >
                                        Delete Selected
                                    </button>
                                    
                                    <button 
                                        id="table-clear-selection-btn" 
                                        class="ml-auto px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition-colors"
                                    >
                                        Clear Selection
                                    </button>
                                </div>
                            </div>
                            
                            <div class="bg-white rounded-lg shadow-md overflow-hidden">
                                <!-- Top Pagination -->
                                <div id="table-pagination-top" class="hidden">
                                    <!-- Pagination controls will be rendered here -->
                                </div>
                                
                                <!-- Table Container with horizontal scroll -->
                                <div class="overflow-x-auto">
                                    <table class="w-full text-sm">
                                        <thead class="bg-gray-50 border-b border-gray-200">
                                            <tr>
                                                <th class="px-4 py-3 text-left">
                                                    <input 
                                                        type="checkbox" 
                                                        id="table-select-all" 
                                                        class="cursor-pointer w-4 h-4"
                                                        title="Select All"
                                                    />
                                                </th>
                                                <th class="px-4 py-3 text-left font-semibold text-gray-700 cursor-pointer hover:bg-gray-100" data-sort="type">
                                                    <div class="flex items-center gap-2">
                                                        Type
                                                        <svg class="w-4 h-4 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16V4m0 0L3 8m4-4l4 4m6 0v12m0 0l4-4m-4 4l-4-4"/>
                                                        </svg>
                                                    </div>
                                                </th>
                                                <th class="px-4 py-3 text-left font-semibold text-gray-700 cursor-pointer hover:bg-gray-100" data-sort="title">
                                                    <div class="flex items-center gap-2">
                                                        Title
                                                        <svg class="w-4 h-4 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16V4m0 0L3 8m4-4l4 4m6 0v12m0 0l4-4m-4 4l-4-4"/>
                                                        </svg>
                                                    </div>
                                                </th>
                                                <th class="px-4 py-3 text-left font-semibold text-gray-700 cursor-pointer hover:bg-gray-100" data-sort="assignee">
                                                    <div class="flex items-center gap-2">
                                                        Assignee
                                                        <svg class="w-4 h-4 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16V4m0 0L3 8m4-4l4 4m6 0v12m0 0l4-4m-4 4l-4-4"/>
                                                        </svg>
                                                    </div>
                                                </th>
                                                <th class="px-4 py-3 text-left font-semibold text-gray-700 cursor-pointer hover:bg-gray-100" data-sort="priority">
                                                    <div class="flex items-center gap-2">
                                                        Priority
                                                        <svg class="w-4 h-4 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16V4m0 0L3 8m4-4l4 4m6 0v12m0 0l4-4m-4 4l-4-4"/>
                                                        </svg>
                                                    </div>
                                                </th>
                                                <th class="px-4 py-3 text-left font-semibold text-gray-700 cursor-pointer hover:bg-gray-100" data-sort="due_date">
                                                    <div class="flex items-center gap-2">
                                                        Due Date
                                                        <svg class="w-4 h-4 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16V4m0 0L3 8m4-4l4 4m6 0v12m0 0l4-4m-4 4l-4-4"/>
                                                        </svg>
                                                    </div>
                                                </th>
                                                <th class="px-4 py-3 text-left font-semibold text-gray-700">
                                                    Planning Estimate
                                                </th>
                                                <th class="px-4 py-3 text-left font-semibold text-gray-700 cursor-pointer hover:bg-gray-100" data-sort="status">
                                                    <div class="flex items-center gap-2">
                                                        Status
                                                        <svg class="w-4 h-4 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16V4m0 0L3 8m4-4l4 4m6 0v12m0 0l4-4m-4 4l-4-4"/>
                                                        </svg>
                                                    </div>
                                                </th>
                                                <th class="px-4 py-3 text-left font-semibold text-gray-700">
                                                    Actions
                                                </th>
                                            </tr>
                                        </thead>
                                        <tbody id="table-body" class="divide-y divide-gray-200">
                                            <!-- Table rows will be dynamically generated -->
                                        </tbody>
                                    </table>
                                </div>
                                
                                <!-- Empty State -->
                                <div id="table-empty-state" class="hidden p-12 text-center">
                                    <svg class="w-16 h-16 mx-auto text-gray-300 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
                                    </svg>
                                    <p class="text-gray-500 text-lg">No items to display</p>
                                    <p class="text-gray-400 text-sm mt-2">Try adjusting your filters</p>
                                </div>
                                
                                <!-- Bottom Pagination -->
                                <div id="table-pagination-bottom" class="hidden">
                                    <!-- Pagination controls will be rendered here -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Review Queue Panel -->
                <div id="review-queue-panel" class="mt-6 hidden">
                    <div class="bg-purple-50 border-2 border-purple-200 rounded-lg p-4">
                        <div class="flex items-center justify-between mb-3">
                            <h3 class="text-lg font-semibold text-purple-900 flex items-center gap-2">
                                📋 Review Queue
                                <span id="review-queue-count" class="text-sm bg-purple-200 px-2 py-1 rounded">0</span>
                            </h3>
                            <button id="toggle-review-queue-btn" class="text-purple-600 hover:text-purple-800 text-sm">
                                Hide
                            </button>
                        </div>
                        <p class="text-xs text-purple-700 mb-3">Status updates waiting for manual review</p>
                        <div id="review-queue-items" class="space-y-2">
                            <!-- Queue items will be loaded here -->
                        </div>
                    </div>
                </div>

                <!-- Status Display -->
                <div class="mt-8 text-center">
                    <div
                        class="inline-flex items-center px-4 py-2 bg-green-100 text-green-800 rounded-full"
                    >
                        <div
                            class="w-2 h-2 bg-green-500 rounded-full mr-2"
                        ></div>
                        System Status: Running
                    </div>
                </div>
            </main>

            <!-- Modals will go here -->
            <div
                id="modal-overlay"
                class="hidden fixed inset-0 bg-black bg-opacity-50 z-50"
            >
                <div class="flex items-center justify-center min-h-screen py-4">
                    <div
                        id="modal-content"
                        class="bg-white rounded-lg p-6 max-w-md w-full mx-4 max-h-[90vh] overflow-y-auto"
                    >
                        <!-- Modal content will be inserted here -->
                    </div>
                </div>
            </div>

            <!-- Relationship Management Modal -->
            <div id="relationship-modal" class="hidden fixed inset-0 bg-gray-600 bg-opacity-50 z-[60] flex items-center justify-center">
                <div class="bg-white rounded-lg shadow-xl w-full max-w-2xl mx-4 max-h-[90vh] overflow-y-auto">
                    <div class="flex items-center justify-between p-6 border-b">
                        <h3 class="text-xl font-semibold text-gray-800">Manage Relationships</h3>
                        <button id="close-relationship-modal-btn" class="text-gray-400 hover:text-gray-600 text-2xl">&times;</button>
                    </div>
                    
                    <div class="p-6">
                        <!-- Current Item Info -->
                        <div id="relationship-item-info" class="bg-gray-50 rounded p-3 mb-4">
                            <!-- Item title will be inserted here -->
                        </div>
                        
                        <!-- Add New Relationship -->
                        <div class="border-b pb-4 mb-4">
                            <h4 class="font-semibold mb-3">Add Relationship</h4>
                            <div class="space-y-3">
                                <select id="relationship-type" class="w-full px-3 py-2 border rounded-md">
                                    <option value="">Select relationship type...</option>
                                    <option value="blocked_by">Blocked By</option>
                                    <option value="blocks">Blocks</option>
                                    <option value="related">Related To</option>
                                    <option value="parent">Parent Of</option>
                                    <option value="child">Child Of</option>
                                </select>
                                
                                <select id="relationship-target-type" class="w-full px-3 py-2 border rounded-md">
                                    <option value="issue">Issue</option>
                                    <option value="action-item">Action Item</option>
                                </select>
                                
                                <select id="relationship-target-id" class="w-full px-3 py-2 border rounded-md">
                                    <option value="">Select item...</option>
                                </select>
                                
                                <button id="add-relationship-btn" class="w-full bg-blue-600 text-white py-2 rounded hover:bg-blue-700">
                                    Add Relationship
                                </button>
                            </div>
                        </div>
                        
                        <!-- Existing Relationships -->
                        <div>
                            <h4 class="font-semibold mb-3">Existing Relationships</h4>
                            <div id="relationships-list" class="space-y-2">
                                <!-- Relationships will be listed here -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- AI Meeting Analysis Modal -->
            <div id="ai-analysis-modal" class="hidden fixed inset-0 bg-gray-600 bg-opacity-50 z-50 flex items-center justify-center">
                <div class="bg-white rounded-lg shadow-xl w-full max-w-4xl mx-4 max-h-[90vh] overflow-y-auto">
                    <div class="flex items-center justify-between p-6 border-b">
                        <div>
                            <h3 class="text-xl font-semibold text-gray-800">AI Meeting Analysis</h3>
                            <p class="text-xs text-gray-500 mt-1">Powered by GPT-3.5-Turbo (~$0.001 per analysis)</p>
                        </div>
                        <button id="close-ai-analysis-modal-btn" class="text-gray-400 hover:text-gray-600 text-2xl">&times;</button>
                    </div>
                    
                    <div class="p-6">
                        <!-- Step 1: Upload -->
                        <div id="upload-step" class="mb-6">
                            <h4 class="font-semibold mb-3">Step 1: Upload Meeting Transcript</h4>
                            <div class="border-2 border-dashed border-gray-300 rounded-lg p-8 text-center hover:border-blue-400 transition-colors">
                                <input type="file" id="transcript-file" accept=".txt" class="hidden">
                                <label for="transcript-file" class="cursor-pointer">
                                    <svg class="mx-auto h-12 w-12 text-gray-400 mb-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"/>
                                    </svg>
                                    <p class="text-sm text-gray-600 font-medium">Click to upload or drag and drop</p>
                                    <p class="text-xs text-gray-500 mt-1">Text files (.txt) only, up to 10MB</p>
                                    <p class="text-xs text-gray-400 mt-1">Maximum ~10,000 words</p>
                                </label>
                                <p id="file-name" class="mt-3 text-sm text-green-600 font-medium hidden"></p>
                            </div>
                            <button id="analyze-btn" disabled
                                    class="mt-4 w-full bg-purple-600 text-white py-3 rounded-lg hover:bg-purple-700 disabled:bg-gray-300 disabled:cursor-not-allowed font-medium transition-colors">
                                Analyze with AI
                            </button>
                            <div id="analysis-progress" class="hidden mt-4 text-center">
                                <div class="inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-purple-600"></div>
                                <p class="text-sm text-gray-600 mt-2">Analyzing transcript with GPT-3.5...</p>
                                <p class="text-xs text-gray-500 mt-1">This may take 30-60 seconds</p>
                            </div>
                        </div>

                        <!-- Step 2: Review AI Suggestions -->
                        <div id="review-step" class="hidden">
                            <div class="bg-blue-50 border border-blue-200 rounded-lg p-3 mb-4">
                                <p class="text-sm text-blue-800">
                                    <strong>Analysis Complete!</strong> Review the suggestions below. 
                                    Uncheck any items you don't want to create.
                                </p>
                                <p class="text-xs text-blue-600 mt-1" id="analysis-cost">
                                    Cost: ~$0.001 | Tokens: 0
                                </p>
                            </div>

                            <!-- Action Items -->
                            <div class="mb-6">
                                <div class="flex items-center justify-between mb-2">
                                    <h5 class="font-medium text-gray-700">Action Items (<span id="ai-action-count">0</span>)</h5>
                                    <button id="toggle-all-actions-btn" class="text-xs text-blue-600 hover:text-blue-700">
                                        Select All / None
                                    </button>
                                </div>
                                <div id="ai-action-items" class="space-y-2 max-h-60 overflow-y-auto">
                                    <!-- AI suggestions will be listed here -->
                                </div>
                            </div>

                            <!-- Issues -->
                            <div class="mb-6">
                                <div class="flex items-center justify-between mb-2">
                                    <h5 class="font-medium text-gray-700">Issues (<span id="ai-issue-count">0</span>)</h5>
                                    <button id="toggle-all-issues-btn" class="text-xs text-blue-600 hover:text-blue-700">
                                        Select All / None
                                    </button>
                                </div>
                                <div id="ai-issues" class="space-y-2 max-h-60 overflow-y-auto">
                                    <!-- AI suggestions will be listed here -->
                                </div>
                            </div>

                            <!-- Status Updates Section -->
                            <div id="status-updates-section" class="mb-6 hidden">
                                <h5 class="font-medium text-gray-700 mb-2 flex items-center gap-2">
                                    <span class="text-xl">🔄</span>
                                    Status Updates
                                    <span id="status-updates-count" class="bg-blue-100 text-blue-800 px-2 py-1 rounded-full text-xs">0</span>
                                </h5>
                                
                                <!-- Matched Updates -->
                                <div id="matched-updates" class="mb-3"></div>
                                
                                <!-- Unmatched Updates -->
                                <div id="unmatched-updates"></div>
                            </div>

                            <!-- Relationships Section -->
                            <div id="relationships-section" class="mb-6 hidden">
                                <h5 class="font-medium text-gray-700 mb-2 flex items-center gap-2">
                                    <span class="text-xl">🔗</span>
                                    Detected Relationships
                                    <span id="relationships-count" class="bg-purple-100 text-purple-800 px-2 py-1 rounded-full text-xs">0</span>
                                </h5>
                                
                                <!-- Created Relationships -->
                                <div id="created-relationships" class="mb-3"></div>
                                
                                <!-- Failed Relationships -->
                                <div id="failed-relationships"></div>
                            </div>

                            <!-- Actions -->
                            <div class="flex justify-between items-center pt-4 border-t">
                                <button id="reset-analysis-btn" class="text-sm text-gray-600 hover:text-gray-800">
                                    ← Upload New Transcript
                                </button>
                                <div class="space-x-3">
                                    <button id="cancel-ai-modal-btn" class="px-4 py-2 text-gray-600 border rounded-lg hover:bg-gray-50">
                                        Cancel
                                    </button>
                                    <button id="create-all-items-btn" class="px-6 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 font-medium">
                                        Create Selected Items
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Item Detail Modal (for Issues and Action Items) -->
            <div id="item-detail-modal" class="hidden fixed inset-0 bg-gray-600 bg-opacity-50 z-50 flex items-center justify-center">
                <div class="bg-white rounded-lg shadow-xl w-full max-w-4xl mx-4 max-h-[90vh] overflow-y-auto">
                    <div class="flex items-center justify-between p-6 border-b">
                        <h3 id="item-detail-title" class="text-xl font-semibold text-gray-800"></h3>
                        <div class="flex items-center gap-2">
                            <button 
                                id="item-detail-edit-btn" 
                                class="px-3 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 transition-colors flex items-center gap-1.5 text-sm"
                                title="Edit">
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"/>
                                </svg>
                                <span>Edit</span>
                            </button>
                            <button 
                                id="item-detail-delete-btn" 
                                class="px-3 py-2 bg-red-600 text-white rounded hover:bg-red-700 transition-colors flex items-center gap-1.5 text-sm"
                                title="Delete">
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/>
                                </svg>
                                <span>Delete</span>
                            </button>
                            <button 
                                id="item-detail-generate-btn" 
                                class="px-3 py-2 bg-purple-600 text-white rounded hover:bg-purple-700 transition-colors flex items-center gap-1.5 text-sm"
                                title="Generate from Document">
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
                                </svg>
                                <span>📄 Generate from Document</span>
                            </button>
                            <button id="close-item-detail-btn" class="text-gray-400 hover:text-gray-600 text-2xl">&times;</button>
                        </div>
                    </div>
                    
                    <!-- Tabs -->
                    <div class="border-b px-6">
                        <div class="flex gap-6">
                            <button class="item-detail-tab-btn py-3 border-b-2 border-blue-500 text-blue-600 font-medium" data-tab="details">
                                Details
                            </button>
                            <button class="item-detail-tab-btn py-3 border-b-2 border-transparent text-gray-600 hover:text-gray-900" data-tab="effort-estimates">
                                📊 Effort Estimates
                            </button>
                            <button class="item-detail-tab-btn py-3 border-b-2 border-transparent text-gray-600 hover:text-gray-900" data-tab="relationships">
                                Relationships
                                <span id="item-detail-relationship-count-tab" class="ml-1 text-sm text-gray-500">(0)</span>
                            </button>
                            <button class="item-detail-tab-btn py-3 border-b-2 border-transparent text-gray-600 hover:text-gray-900" data-tab="comments">
                                Comments
                                <span id="item-detail-comment-count-tab" class="ml-1 text-sm text-gray-500">(0)</span>
                            </button>
                            <button class="item-detail-tab-btn py-3 border-b-2 border-transparent text-gray-600 hover:text-gray-900" data-tab="checklists">
                                Checklists
                                <span id="item-detail-checklist-count-tab" class="ml-1 text-sm text-gray-500">(0)</span>
                            </button>
                            <button class="item-detail-tab-btn py-3 border-b-2 border-transparent text-gray-600 hover:text-gray-900" data-tab="attachments">
                                Attachments
                                <span id="item-detail-attachment-count" class="ml-1 text-sm text-gray-500">(0)</span>
                            </button>
                        </div>
                    </div>
                    
                    <div class="p-6">
                        <!-- Details Tab -->
                        <div id="details-tab" class="item-detail-tab-panel">
                            <!-- Item Info -->
                            <div id="item-detail-info" class="bg-gray-50 rounded-lg p-4">
                                <!-- Item details will be displayed here -->
                            </div>
                        </div>
                        
                        <!-- Effort Estimates Tab -->
                        <div id="effort-estimates-tab" class="item-detail-tab-panel hidden">
                            <div class="space-y-6">
                                <!-- Version History Section -->
                                <div class="bg-white rounded-lg border border-gray-200">
                                    <div class="p-4 border-b border-gray-200 flex justify-between items-center">
                                        <h3 class="text-lg font-semibold flex items-center gap-2">
                                            <span>📝</span>
                                            Estimate Version History
                                        </h3>
                                        <button 
                                            id="export-estimate-history-btn"
                                            class="px-3 py-1.5 text-sm bg-green-600 text-white rounded hover:bg-green-700 transition-colors flex items-center gap-1.5"
                                            title="Export as CSV">
                                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
                                            </svg>
                                            Export CSV
                                        </button>
                                    </div>
                                    <div id="estimate-history-container" class="p-4">
                                        <!-- Version history will be dynamically loaded here -->
                                        <p class="text-gray-500 text-center py-8">Loading estimate history...</p>
                                    </div>
                                    <div id="estimate-history-expand-container" class="hidden p-4 pt-0 text-center">
                                        <button 
                                            id="show-all-estimates-btn"
                                            class="text-sm text-blue-600 hover:underline">
                                            Show All Versions
                                        </button>
                                    </div>
                                </div>

                                <!-- Current Estimation Section -->
                                <div class="bg-white rounded-lg border border-gray-200">
                                    <div class="p-4 border-b border-gray-200">
                                        <h3 class="text-lg font-semibold flex items-center gap-2">
                                            <span>🎯</span>
                                            Current Estimation
                                        </h3>
                                    </div>
                                    <div id="effort-estimate-form-container" class="p-4">
                                        <!-- Effort estimation form will be dynamically loaded here -->
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Relationships Tab -->
                        <div id="relationships-tab" class="item-detail-tab-panel hidden">
                            <h3 class="text-lg font-semibold mb-4 flex items-center gap-2">
                                <span>🔗</span>
                                Relationships
                                <span id="item-detail-relationship-count" class="text-sm text-gray-500">(0)</span>
                            </h3>
                            
                            <div class="relationships-container space-y-6">
                                <!-- Blocked By Section -->
                                <div class="relationship-section">
                                    <h4 class="font-semibold text-gray-700 mb-3 flex items-center gap-2">
                                        <span>🚫</span>
                                        <span>Blocked By</span>
                                    </h4>
                                    <div id="blocked-by-list" class="relationship-list pl-6">
                                        <p class="text-sm text-gray-500 italic">No blocking issues</p>
                                    </div>
                                    <button class="text-sm text-blue-600 hover:underline mt-2 ml-6" data-action="add-relationship" data-type="blocked_by">
                                        + Add blocking issue
                                    </button>
                                </div>
                                
                                <!-- Blocks Section -->
                                <div class="relationship-section border-t pt-6">
                                    <h4 class="font-semibold text-gray-700 mb-3 flex items-center gap-2">
                                        <span>⛔</span>
                                        <span>Blocks</span>
                                    </h4>
                                    <div id="blocks-list" class="relationship-list pl-6">
                                        <p class="text-sm text-gray-500 italic">Not blocking any issues</p>
                                    </div>
                                    <button class="text-sm text-blue-600 hover:underline mt-2 ml-6" data-action="add-relationship" data-type="blocks">
                                        + Add blocked issue
                                    </button>
                                </div>
                                
                                <!-- Related Issues Section -->
                                <div class="relationship-section border-t pt-6">
                                    <h4 class="font-semibold text-gray-700 mb-3 flex items-center gap-2">
                                        <span>🔄</span>
                                        <span>Related Issues</span>
                                    </h4>
                                    <div id="related-issues-list" class="relationship-list pl-6">
                                        <p class="text-sm text-gray-500 italic">No related issues</p>
                                    </div>
                                    <button class="text-sm text-blue-600 hover:underline mt-2 ml-6" data-action="add-relationship" data-type="related">
                                        + Add related issue
                                    </button>
                                </div>
                                
                                <!-- Parent Issue Section -->
                                <div class="relationship-section border-t pt-6">
                                    <h4 class="font-semibold text-gray-700 mb-3 flex items-center gap-2">
                                        <span>📊</span>
                                        <span>Parent Issue</span>
                                    </h4>
                                    <div id="parent-issue" class="relationship-list pl-6">
                                        <p class="text-sm text-gray-500 italic">No parent issue</p>
                                    </div>
                                    <button class="text-sm text-blue-600 hover:underline mt-2 ml-6" data-action="add-relationship" data-type="parent">
                                        + Link to parent
                                    </button>
                                </div>
                                
                                <!-- Child Issues Section -->
                                <div class="relationship-section border-t pt-6">
                                    <h4 class="font-semibold text-gray-700 mb-3 flex items-center gap-2">
                                        <span>👶</span>
                                        <span>Child Issues</span>
                                    </h4>
                                    <div id="child-issues-list" class="relationship-list pl-6">
                                        <p class="text-sm text-gray-500 italic">No child issues</p>
                                    </div>
                                    <button class="text-sm text-blue-600 hover:underline mt-2 ml-6" data-action="add-relationship" data-type="child">
                                        + Add child issue
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Comments Tab -->
                        <div id="comments-tab" class="item-detail-tab-panel hidden">
                            <h3 class="text-lg font-semibold mb-4 flex items-center gap-2">
                                <span>💬</span>
                                Comments
                                <span id="item-detail-comment-count" class="text-sm text-gray-500">(0)</span>
                            </h3>
                            
                            <!-- Comment Input -->
                            <div class="mb-4">
                                <div class="relative">
                                    <textarea 
                                        id="item-detail-new-comment"
                                        class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 resize-none"
                                        rows="3"
                                        placeholder="Add a comment... Use @username to mention someone"></textarea>
                                    
                                    <!-- Mention Autocomplete Dropdown -->
                                    <div id="item-detail-mention-dropdown" class="hidden absolute bg-white border border-gray-300 rounded-lg shadow-lg mt-1 max-h-48 overflow-y-auto z-50"></div>
                                </div>
                                
                                <div class="flex justify-between items-center mt-2">
                                    <div class="text-xs text-gray-500">
                                        Supports <strong>@mentions</strong> and basic <strong>markdown</strong>
                                    </div>
                                    <button 
                                        id="add-item-detail-comment-btn"
                                        class="bg-indigo-600 hover:bg-indigo-700 text-white px-4 py-2 rounded-lg text-sm">
                                        Add Comment
                                    </button>
                                </div>
                            </div>
                            
                            <!-- Comments List -->
                            <div id="item-detail-comments-list" class="space-y-3 max-h-96 overflow-y-auto">
                                <!-- Comments will be populated here -->
                            </div>
                        </div>
                        
                        <!-- Checklists Tab -->
                        <div id="checklists-tab" class="item-detail-tab-panel hidden">
                            <h3 class="text-lg font-semibold mb-4 flex items-center gap-2">
                                <span>✓</span>
                                Checklists
                                <span id="item-detail-checklist-count" class="text-sm text-gray-500">(0)</span>
                            </h3>
                            
                            <!-- Checklists Container -->
                            <div id="linked-checklists-container" class="space-y-3 max-h-[500px] overflow-y-auto">
                                <!-- Checklists will be populated here -->
                                <div class="text-center py-8 text-gray-500">
                                    <p>Loading checklists...</p>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Attachments Tab -->
                        <div id="attachments-tab" class="item-detail-tab-panel hidden">
                            <h3 class="text-lg font-semibold mb-4 flex items-center gap-2">
                                <span>📎</span>
                                Attachments
                                <span id="item-detail-attachment-count-display" class="text-sm text-gray-500">(0)</span>
                            </h3>
                            
                            <!-- Attachment Upload -->
                            <div class="mb-4">
                                <input 
                                    type="file" 
                                    id="item-detail-attachment-upload" 
                                    multiple 
                                    class="block w-full text-sm text-gray-500
                                        file:mr-4 file:py-2 file:px-4
                                        file:rounded-full file:border-0
                                        file:text-sm file:font-semibold
                                        file:bg-blue-50 file:text-blue-700
                                        hover:file:bg-blue-100
                                        cursor-pointer"
                                />
                                <p class="text-xs text-gray-500 mt-1">Max 10MB per file</p>
                            </div>
                            
                            <!-- Attachments List -->
                            <div id="item-detail-attachments-list">
                                <!-- Attachments will be populated here -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Transcripts Viewer Modal -->
            <div id="transcripts-modal" class="hidden fixed inset-0 bg-gray-600 bg-opacity-50 z-50 flex items-center justify-center">
                <div class="bg-white rounded-lg shadow-xl w-full max-w-5xl mx-4 max-h-[90vh] overflow-y-auto">
                    <div class="flex items-center justify-between p-6 border-b">
                        <h3 class="text-xl font-semibold text-gray-800">Meeting Transcripts</h3>
                        <button id="close-transcripts-modal-btn" class="text-gray-400 hover:text-gray-600 text-2xl">&times;</button>
                    </div>
                    
                    <div class="p-6">
                        <!-- Loading State -->
                        <div id="transcripts-loading" class="text-center py-8 hidden">
                            <div class="inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-gray-600"></div>
                            <p class="text-sm text-gray-600 mt-2">Loading transcripts...</p>
                        </div>

                        <!-- Transcripts List -->
                        <div id="transcripts-list-view" class="hidden">
                            <div id="transcripts-list" class="space-y-3">
                                <!-- Transcripts will be listed here -->
                            </div>
                            <div id="no-transcripts" class="text-center py-8 text-gray-500 hidden">
                                <svg class="mx-auto h-12 w-12 text-gray-400 mb-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
                                </svg>
                                <p>No transcripts yet</p>
                            </div>
                        </div>

                        <!-- Single Transcript View -->
                        <div id="transcript-detail-view" class="hidden">
                            <button id="back-to-list-btn" class="text-sm text-blue-600 hover:text-blue-700 mb-4 flex items-center gap-1">
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
                                </svg>
                                Back to list
                            </button>
                            
                            <div id="transcript-header" class="bg-gray-50 rounded-lg p-4 mb-4">
                                <!-- Transcript metadata will go here -->
                            </div>
                            
                            <div class="bg-white border rounded-lg p-4">
                                <h4 class="font-semibold mb-3">Transcript Text</h4>
                                <pre id="transcript-text" class="whitespace-pre-wrap text-sm text-gray-700 font-mono bg-gray-50 p-4 rounded max-h-96 overflow-y-auto">
                                    <!-- Transcript text will go here -->
                                </pre>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- AI Checklist Generation Modal -->
            <div id="ai-checklist-modal" class="hidden fixed inset-0 bg-gray-600 bg-opacity-50 z-50 flex items-center justify-center">
                <div class="bg-white rounded-lg shadow-xl w-full max-w-2xl mx-4 max-h-[90vh] overflow-y-auto">
                    <div class="flex items-start justify-between p-6 border-b">
                        <div class="flex-1 pr-4">
                            <h3 class="text-xl font-semibold text-gray-800">
                                AI Checklist Generation
                                <span id="ai-checklist-step-name" class="text-base font-normal text-gray-600"></span>
                            </h3>
                            
                            <!-- Step Indicator -->
                            <div class="flex items-center gap-2 mt-3 mb-2">
                                <div id="step-indicator-1" class="flex items-center">
                                    <div class="w-6 h-6 rounded-full bg-blue-500 text-white flex items-center justify-center text-xs font-semibold">1</div>
                                    <span class="text-xs text-gray-600 ml-1.5">Select</span>
                                </div>
                                <div class="w-8 h-0.5 bg-gray-300" id="step-line-1"></div>
                                <div id="step-indicator-2" class="flex items-center">
                                    <div class="w-6 h-6 rounded-full bg-gray-300 text-gray-500 flex items-center justify-center text-xs font-semibold">2</div>
                                    <span class="text-xs text-gray-500 ml-1.5">Analyze</span>
                                </div>
                                <div class="w-8 h-0.5 bg-gray-300" id="step-line-2"></div>
                                <div id="step-indicator-3" class="flex items-center">
                                    <div class="w-6 h-6 rounded-full bg-gray-300 text-gray-500 flex items-center justify-center text-xs font-semibold">3</div>
                                    <span class="text-xs text-gray-500 ml-1.5">Generate</span>
                                </div>
                                <div class="w-8 h-0.5 bg-gray-300" id="step-line-3"></div>
                                <div id="step-indicator-4" class="flex items-center">
                                    <div class="w-6 h-6 rounded-full bg-gray-300 text-gray-500 flex items-center justify-center text-xs font-semibold">4</div>
                                    <span class="text-xs text-gray-500 ml-1.5">Preview</span>
                                </div>
                                <div class="w-8 h-0.5 bg-gray-300" id="step-line-4"></div>
                                <div id="step-indicator-5" class="flex items-center">
                                    <div class="w-6 h-6 rounded-full bg-gray-300 text-gray-500 flex items-center justify-center text-xs font-semibold">5</div>
                                    <span class="text-xs text-gray-500 ml-1.5">Create</span>
                                </div>
                            </div>
                            
                            <p class="text-sm text-gray-600 mt-2" id="ai-checklist-project-name"></p>
                            <p class="text-sm text-gray-700 mt-1" id="ai-checklist-item-info"></p>
                            <p class="text-xs text-gray-500 mt-1" id="ai-checklist-sources"></p>
                        </div>
                        <button id="close-ai-checklist-modal-btn" class="text-gray-400 hover:text-gray-600 text-2xl flex-shrink-0">&times;</button>
                    </div>
                    
                    <div class="p-6">
                        <!-- Source Selection State -->
                        <div id="ai-checklist-source-selection" class="hidden">
                            <div class="mb-6">
                                <h4 class="font-semibold text-gray-800 mb-3">📋 Select Analysis Sources</h4>
                                <p class="text-sm text-gray-600 mb-4">Choose what information the AI should analyze:</p>
                                
                                <!-- Description Option -->
                                <label class="flex items-start space-x-3 p-4 border rounded-lg cursor-pointer hover:bg-gray-50 transition-colors mb-3">
                                    <input type="checkbox" id="use-description-checkbox" checked class="mt-1">
                                    <div class="flex-1">
                                        <div class="font-medium text-gray-900">Use Description</div>
                                        <p class="text-xs text-gray-500 mt-1">Analyze the issue/action description text</p>
                                    </div>
                                </label>
                                
                                <!-- Attachments Option -->
                                <div class="border rounded-lg p-4 mb-4">
                                    <div class="flex items-center justify-between mb-3">
                                        <div class="font-medium text-gray-900">Use Attachments</div>
                                        <span id="attachment-count-badge" class="text-xs px-2 py-1 bg-blue-100 text-blue-700 rounded-full">0 selected</span>
                                    </div>
                                    
                                    <!-- Existing Attachments List -->
                                    <div id="existing-attachments-list" class="space-y-2 mb-3">
                                        <!-- Will be populated dynamically -->
                                    </div>
                                    
                                    <!-- Upload New Files -->
                                    <div class="mt-3">
                                        <label class="block text-sm text-gray-600 mb-2">Upload New Files (PDF, DOCX, TXT)</label>
                                        <input type="file" id="attachment-upload-input" 
                                               accept=".pdf,.docx,.doc,.txt" 
                                               multiple 
                                               class="hidden">
                                        <button type="button" id="upload-attachment-btn" 
                                                class="w-full border-2 border-dashed border-gray-300 rounded-lg py-3 text-sm text-gray-600 hover:border-blue-400 hover:text-blue-600 transition-colors">
                                            <svg class="w-5 h-5 inline mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"/>
                                            </svg>
                                            Click to upload files
                                        </button>
                                    </div>
                                    
                                    <!-- Newly Uploaded Files -->
                                    <div id="newly-uploaded-files" class="mt-3 space-y-2">
                                        <!-- Will show uploaded files here -->
                                    </div>
                                    
                                    <p class="text-xs text-gray-500 mt-2">
                                        Supported: PDF, DOCX, TXT • Max 10MB per file • Up to 5 files
                                    </p>
                                </div>
                            </div>
                            
                            <div class="flex gap-3">
                                <button id="cancel-source-selection-btn" class="flex-1 bg-gray-200 text-gray-700 py-2 rounded-lg hover:bg-gray-300">
                                    Cancel
                                </button>
                                <button id="generate-with-sources-btn" class="flex-1 bg-blue-600 text-white py-2 rounded-lg hover:bg-blue-700">
                                    Analyze Sources
                                </button>
                            </div>
                        </div>
                        
                        <!-- Workstream Analysis State -->
                        <div id="ai-checklist-workstream-analysis" class="hidden">
                            <div class="bg-blue-50 border border-blue-200 rounded-lg p-4 mb-4">
                                <div class="flex items-start">
                                    <svg class="w-5 h-5 text-blue-500 mt-0.5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                                        <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"/>
                                    </svg>
                                    <div class="flex-1">
                                        <p class="text-sm font-medium text-blue-800">Document Analyzed</p>
                                        <p class="text-xs text-blue-600 mt-1">Choose how to generate your checklists</p>
                                    </div>
                                </div>
                            </div>

                            <div id="workstream-analysis-details" class="mb-4">
                                <!-- Analysis details will be rendered here -->
                            </div>

                            <div class="space-y-3 mb-4">
                                <button id="generate-single-checklist-btn" class="w-full text-left border rounded-lg p-4 hover:bg-gray-50 transition-colors">
                                    <div class="flex items-start">
                                        <div class="bg-blue-100 rounded-lg p-2 mr-3">
                                            <svg class="w-5 h-5 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
                                            </svg>
                                        </div>
                                        <div class="flex-1">
                                            <div class="font-medium text-gray-900">
                                                Generate Single Comprehensive Checklist
                                                <span id="single-recommended-badge" class="hidden text-xs bg-green-100 text-green-700 px-2 py-0.5 rounded-full ml-2">Recommended</span>
                                            </div>
                                            <p class="text-xs text-gray-600 mt-1">One checklist with all tasks (best for smaller documents)</p>
                                        </div>
                                    </div>
                                </button>

                                <button id="generate-multiple-checklists-btn" class="w-full text-left border rounded-lg p-4 hover:bg-gray-50 transition-colors">
                                    <div class="flex items-start">
                                        <div class="bg-blue-100 rounded-lg p-2 mr-3">
                                            <svg class="w-5 h-5 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
                                            </svg>
                                        </div>
                                        <div class="flex-1">
                                            <div class="font-medium text-gray-900">
                                                Generate Multiple Focused Checklists
                                                <span id="multiple-recommended-badge" class="hidden text-xs bg-green-100 text-green-700 px-2 py-0.5 rounded-full ml-2">Recommended</span>
                                            </div>
                                            <p class="text-xs text-gray-600 mt-1">Separate checklist for each workstream (best for complex documents)</p>
                                        </div>
                                    </div>
                                </button>
                            </div>

                            <div class="flex gap-3">
                                <button id="cancel-workstream-analysis-btn" class="flex-1 bg-gray-200 text-gray-700 py-2 rounded-lg hover:bg-gray-300">
                                    Cancel
                                </button>
                            </div>
                        </div>

                        <!-- Loading State -->
                        <div id="ai-checklist-loading" class="hidden text-center py-12">
                            <!-- AI Animation Container -->
                            <div class="relative inline-block mb-6">
                                <!-- Outer pulse ring -->
                                <div class="absolute inset-0 rounded-full bg-blue-400 opacity-20 animate-ping"></div>
                                <!-- Middle rotating ring -->
                                <div class="relative inline-block animate-spin rounded-full h-16 w-16 border-4 border-blue-200 border-t-blue-600"></div>
                                <!-- Center sparkle icon -->
                                <div class="absolute inset-0 flex items-center justify-center">
                                    <span class="text-3xl animate-pulse">✨</span>
                                </div>
                            </div>
                            
                            <div class="space-y-2">
                                <p id="loading-main-text" class="text-base text-gray-700 font-semibold">AI is analyzing your content...</p>
                                <p id="loading-sub-text" class="text-sm text-gray-600">Creating a comprehensive checklist</p>
                                
                                <!-- Batch Progress Bar (hidden by default) -->
                                <div id="batch-progress-container" class="hidden mt-4 px-8">
                                    <div class="flex justify-between text-xs text-gray-600 mb-1">
                                        <span id="batch-progress-text">Generating checklist 1 of 6...</span>
                                        <span id="batch-progress-percent">17%</span>
                                    </div>
                                    <div class="w-full bg-gray-200 rounded-full h-2">
                                        <div id="batch-progress-bar" class="bg-blue-600 h-2 rounded-full transition-all duration-500" style="width: 0%"></div>
                                    </div>
                                </div>
                                
                                <!-- Progress dots -->
                                <div class="flex items-center justify-center gap-1.5 mt-4">
                                    <div class="w-2 h-2 bg-blue-600 rounded-full animate-bounce" style="animation-delay: 0ms"></div>
                                    <div class="w-2 h-2 bg-blue-600 rounded-full animate-bounce" style="animation-delay: 150ms"></div>
                                    <div class="w-2 h-2 bg-blue-600 rounded-full animate-bounce" style="animation-delay: 300ms"></div>
                                </div>
                                
                                <p id="loading-time-estimate" class="text-xs text-gray-500 mt-3">This usually takes 10-30 seconds</p>
                            </div>
                        </div>

                        <!-- Error State -->
                        <div id="ai-checklist-error" class="hidden">
                            <div class="bg-red-50 border border-red-200 rounded-lg p-4 mb-4">
                                <div class="flex items-start">
                                    <svg class="w-6 h-6 text-red-500 mt-0.5 mr-3" fill="currentColor" viewBox="0 0 20 20">
                                        <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd"/>
                                    </svg>
                                    <div class="flex-1">
                                        <p class="text-sm font-semibold text-red-900">Generation Failed</p>
                                        <p id="ai-checklist-error-message" class="text-sm text-red-700 mt-1"></p>
                                        
                                        <!-- Helpful suggestions -->
                                        <div id="ai-checklist-error-suggestions" class="mt-3 bg-white rounded-md p-3 border border-red-100">
                                            <p class="text-xs font-medium text-gray-700 mb-2">💡 Try these solutions:</p>
                                            <ul class="text-xs text-gray-600 space-y-1 list-disc list-inside">
                                                <li>Check your internet connection</li>
                                                <li>Make sure the issue/action has a clear description</li>
                                                <li>Wait a moment and try again (rate limit: 10/hour)</li>
                                            </ul>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="flex gap-2">
                                <button id="retry-ai-checklist-btn" class="flex-1 bg-blue-600 text-white py-2.5 rounded-lg hover:bg-blue-700 font-medium transition-colors">
                                    <span class="inline-flex items-center gap-2">
                                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/>
                                        </svg>
                                        Try Again
                                    </span>
                                </button>
                                <button id="cancel-error-ai-checklist-btn" class="flex-1 bg-gray-200 text-gray-700 py-2.5 rounded-lg hover:bg-gray-300 font-medium transition-colors">
                                    Cancel
                                </button>
                            </div>
                        </div>

                        <!-- Success State - Preview (Single) -->
                        <div id="ai-checklist-preview" class="hidden">
                            <div class="bg-green-50 border border-green-200 rounded-lg p-4 mb-4">
                                <div class="flex items-start">
                                    <svg class="w-5 h-5 text-green-500 mt-0.5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                                        <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
                                    </svg>
                                    <div class="flex-1">
                                        <p class="text-sm font-medium text-green-800">Checklist Generated!</p>
                                        <p class="text-xs text-green-600 mt-1">Review the checklist below and create it when ready</p>
                                    </div>
                                </div>
                            </div>

                            <div class="border rounded-lg p-4 mb-4 bg-gray-50">
                                <div class="flex items-center justify-between mb-3">
                                    <h4 class="font-semibold text-gray-800">Generated Checklist</h4>
                                    <span id="ai-checklist-template-badge" class="text-xs px-2 py-1 bg-blue-100 text-blue-700 rounded-full"></span>
                                </div>
                                <div id="ai-checklist-sections" class="space-y-3 max-h-96 overflow-y-auto">
                                    <!-- Sections and items will be rendered here -->
                                </div>
                            </div>

                            <div class="flex gap-3">
                                <button id="cancel-ai-checklist-btn" class="flex-1 bg-gray-200 text-gray-700 py-2 rounded-lg hover:bg-gray-300">
                                    Cancel
                                </button>
                                <button id="create-ai-checklist-btn" class="flex-1 bg-blue-600 text-white py-2 rounded-lg hover:bg-blue-700">
                                    Create Checklist
                                </button>
                            </div>
                        </div>

                        <!-- Success State - Batch Preview (Multiple) -->
                        <div id="ai-checklist-batch-preview" class="hidden">
                            <!-- Summary Section -->
                            <div id="batch-summary" class="border rounded-lg p-4 mb-4">
                                <!-- Will be rendered dynamically -->
                            </div>

                            <!-- Rate Limit Info (if applicable) -->
                            <div id="batch-rate-limit-warning" class="hidden bg-yellow-50 border border-yellow-200 rounded-lg p-3 mb-4">
                                <div class="flex items-start">
                                    <svg class="w-4 h-4 text-yellow-600 mt-0.5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                                        <path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd"/>
                                    </svg>
                                    <div class="flex-1">
                                        <p class="text-xs font-medium text-yellow-800" id="rate-limit-warning-text"></p>
                                    </div>
                                </div>
                            </div>

                            <div class="mb-4 max-h-96 overflow-y-auto space-y-3" id="batch-checklist-previews">
                                <!-- Batch previews will be rendered here -->
                            </div>

                            <div class="flex gap-3">
                                <button id="cancel-batch-preview-btn" class="flex-1 bg-gray-200 text-gray-700 py-2 rounded-lg hover:bg-gray-300">
                                    Cancel
                                </button>
                                <button id="retry-failed-checklists-btn" class="hidden flex-1 bg-yellow-600 text-white py-2 rounded-lg hover:bg-yellow-700">
                                    <span id="retry-btn-text">Retry Failed</span>
                                </button>
                                <button id="create-batch-checklists-btn" class="flex-1 bg-blue-600 text-white py-2 rounded-lg hover:bg-blue-700">
                                    <span id="create-batch-btn-text">Create All Checklists</span>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Edit Project Modal -->
        <div id="editProjectModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
            <div class="bg-white rounded-lg p-6 w-full max-w-2xl max-h-[90vh] overflow-y-auto">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-2xl font-bold">Edit Project</h2>
                    <button id="closeEditProjectModal" class="text-gray-500 hover:text-gray-700">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                        </svg>
                    </button>
                </div>
                
                <form id="editProjectForm">
                    <input type="hidden" id="editProjectId">
                    
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Project Name *</label>
                        <input type="text" id="editProjectName" required
                               class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                    </div>
                    
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Description</label>
                        <textarea id="editProjectDescription" rows="3"
                                  class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"></textarea>
                    </div>
                    
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Template</label>
                        <select id="editProjectTemplate"
                                class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                            <option value="generic">Generic Project</option>
                            <option value="cloud_migration">Cloud Migration</option>
                            <option value="software_development">Software Development</option>
                            <option value="infrastructure">Infrastructure</option>
                        </select>
                    </div>
                    
                    <div class="grid grid-cols-2 gap-4 mb-6">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Start Date</label>
                            <input type="date" id="editProjectStartDate"
                                   class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">End Date</label>
                            <input type="date" id="editProjectEndDate"
                                   class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                        </div>
                    </div>
                    
                    <!-- Microsoft Teams Integration -->
                    <div class="mb-6 border-t pt-6">
                        <div class="flex items-center gap-2 mb-4">
                            <svg class="w-5 h-5 text-blue-600" fill="currentColor" viewBox="0 0 24 24">
                                <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
                            </svg>
                            <h3 class="text-lg font-semibold text-gray-900">Microsoft Teams Integration</h3>
                        </div>
                        
                        <div class="mb-4">
                            <label class="flex items-center gap-2 cursor-pointer">
                                <input type="checkbox" id="editTeamsNotificationsEnabled" 
                                       class="w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500">
                                <span class="text-sm font-medium text-gray-700">Enable Teams Notifications</span>
                            </label>
                            <p class="text-sm text-gray-500 mt-1 ml-6">Send real-time notifications and daily reports to your Microsoft Teams channel</p>
                        </div>
                        
                        <div class="mb-4">
                            <label class="block text-sm font-medium text-gray-700 mb-2">Teams Webhook URL</label>
                            <input type="url" id="editTeamsWebhookUrl" 
                                   placeholder="https://your-org.webhook.office.com/webhookb2/..."
                                   class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                            <p class="text-sm text-gray-500 mt-1">Get your webhook URL from Teams → Channel → Connectors → Incoming Webhook</p>
                        </div>
                    </div>
                    
                    <!-- Checklist Completion Settings -->
                    <div class="mb-6 border-t pt-6">
                        <div class="flex items-center gap-2 mb-4">
                            <svg class="w-5 h-5 text-green-600" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"/>
                                <path fill-rule="evenodd" d="M4 5a2 2 0 012-2 3 3 0 003 3h2a3 3 0 003-3 2 2 0 012 2v11a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3zm-3 4a1 1 0 100 2h.01a1 1 0 100-2H7zm3 0a1 1 0 100 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"/>
                            </svg>
                            <h3 class="text-lg font-semibold text-gray-900">Checklist Settings</h3>
                        </div>
                        
                        <div class="mb-4">
                            <label class="flex items-center gap-2 cursor-pointer">
                                <input type="checkbox" id="editChecklistCompletionEnabled" 
                                       class="w-4 h-4 text-green-600 border-gray-300 rounded focus:ring-green-500">
                                <span class="text-sm font-medium text-gray-700">Enable Checklist Completion Requirements</span>
                            </label>
                            <p class="text-sm text-gray-500 mt-1 ml-6">When enabled, issues and action items must have complete checklists before they can be marked as Done. Checklist badges will appear on kanban cards showing completion status.</p>
                        </div>
                    </div>
                    
                    <div class="flex justify-end gap-3">
                        <button type="button" id="cancelEditProject"
                                class="px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50">
                            Cancel
                        </button>
                        <button type="submit"
                                class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700">
                            Save Changes
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Archived Projects Modal -->
        <div id="archivedProjectsModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
            <div class="bg-white rounded-lg p-6 w-full max-w-4xl max-h-[90vh] overflow-y-auto">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-2xl font-bold">Archived Projects</h2>
                    <button id="closeArchivedProjectsModal" class="text-gray-500 hover:text-gray-700">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                        </svg>
                    </button>
                </div>
                
                <div id="archivedProjectsList" class="space-y-4">
                    <!-- Archived projects will be loaded here -->
                </div>
            </div>
        </div>

        <!-- Edit Issue Modal -->
        <div id="editIssueModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
            <div class="bg-white rounded-lg p-6 w-full max-w-2xl max-h-[90vh] overflow-y-auto">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-2xl font-bold">Edit Issue</h2>
                    <button id="closeEditIssueModal" class="text-gray-500 hover:text-gray-700">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                        </svg>
                    </button>
                </div>
                
                <form id="editIssueForm">
                    <input type="hidden" id="edit-issue-id">
                    
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Title *</label>
                        <input type="text" id="edit-issue-title" required
                               class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                    </div>
                    
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Description *</label>
                        <textarea id="edit-issue-description" rows="4" required
                                  class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"></textarea>
                    </div>
                    
                    <div class="grid grid-cols-2 gap-4 mb-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Assignee *</label>
                            <select id="edit-issue-assignee" required
                                    class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                                <option value="">Select Assignee</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Due Date *</label>
                            <input type="date" id="edit-issue-due-date" required
                                   class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-2 gap-4 mb-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Priority *</label>
                            <select id="edit-issue-priority" required
                                    class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                                <option value="low">Low</option>
                                <option value="medium">Medium</option>
                                <option value="high">High</option>
                                <option value="critical">Critical</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Status *</label>
                            <select id="edit-issue-status" required
                                    class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                                <option value="To Do">To Do</option>
                                <option value="In Progress">In Progress</option>
                                <option value="Blocked">Blocked</option>
                                <option value="Done">Done</option>
                            </select>
                        </div>
                    </div>
                    
                    <!-- Actual Hours - Time Tracking -->
                    <div class="mb-4 p-3 bg-blue-50 rounded-lg border border-blue-200">
                        <div class="flex items-center justify-between">
                            <div class="flex-1">
                                <label class="block text-sm font-medium text-gray-700 mb-2">⏱️ Actual Hours Logged</label>
                                <div class="flex items-center gap-2">
                                    <input type="number" id="edit-issue-actual-hours" step="0.5" min="0" max="999" readonly
                                           class="w-32 px-3 py-2 border border-gray-300 rounded-lg bg-gray-50 focus:ring-2 focus:ring-blue-500"
                                           title="Auto-calculated from time entries">
                                    <span class="text-sm text-gray-600">hours</span>
                                    <span id="edit-issue-time-count" class="text-xs px-2 py-1 rounded bg-blue-200">0 entries</span>
                                </div>
                            </div>
                            <button type="button" id="edit-issue-view-timesheet" class="text-sm px-3 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700">
                                📋 View Timesheet
                            </button>
                        </div>
                    </div>
                    
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Category</label>
                        <select id="edit-issue-category"
                                class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                            <option value="">Select Category</option>
                        </select>
                    </div>
                    
                    <div class="mb-6">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Tags</label>
                        <div id="edit-issue-selected-tags" class="mb-3">
                            <!-- Selected tags will be displayed here as badges -->
                        </div>
                        <select id="edit-issue-tags" multiple
                                class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                                style="min-height: 100px;">
                            <option value="" disabled>Loading tags...</option>
                        </select>
                        <small class="text-gray-500">Hold Ctrl/Cmd to select multiple tags</small>
                    </div>
                    
                    <!-- Effort Estimation Section (Phase 1 Enhanced) -->
                    <div class="mb-6 border-t pt-4">
                        <h3 class="text-lg font-semibold mb-3">⏱️ Effort Estimation</h3>
                        
                        <!-- Manual Estimate Input -->
                        <div class="mb-4">
                            <label class="block text-sm font-medium text-gray-700 mb-2">Manual Estimate (hours)</label>
                            <input type="number" id="edit-issue-estimated-hours" step="0.5" min="0" max="999"
                                   class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                                   placeholder="e.g., 50">
                        </div>
                        
                        <!-- AI Estimate (shown after generation) -->
                        <div id="edit-issue-ai-estimate-section" class="hidden mb-4">
                            <div class="flex items-center justify-between p-3 bg-blue-50 rounded-lg border border-blue-200">
                                <div>
                                    <span class="text-sm font-medium text-gray-700">AI Estimate:</span>
                                    <span id="edit-issue-ai-hours" class="text-lg font-bold text-blue-600 ml-2">--</span>
                                    <span class="text-sm text-gray-600">hours</span>
                                    <span id="edit-issue-ai-confidence" class="ml-2 text-xs px-2 py-1 rounded bg-blue-200">--</span>
                                </div>
                                <button type="button" id="edit-issue-view-breakdown" class="text-xs px-3 py-1 bg-blue-600 text-white rounded hover:bg-blue-700">
                                    View Breakdown ↗
                                </button>
                            </div>
                        </div>
                        
                        <!-- Hybrid Estimate (shown after selection) -->
                        <div id="edit-issue-hybrid-estimate-section" class="hidden mb-4">
                            <div class="flex items-center justify-between p-3 bg-green-50 rounded-lg border border-green-200">
                                <div>
                                    <span class="text-sm font-medium text-gray-700">Hybrid Estimate:</span>
                                    <span id="edit-issue-hybrid-hours" class="text-lg font-bold text-green-600 ml-2">--</span>
                                    <span class="text-sm text-gray-600">hours</span>
                                    <span id="edit-issue-hybrid-count" class="ml-2 text-xs px-2 py-1 rounded bg-green-200">--</span>
                                </div>
                                <button type="button" id="edit-issue-view-hybrid-breakdown" class="text-xs px-3 py-1 bg-green-600 text-white rounded hover:bg-green-700">
                                    View Breakdown ↗
                                </button>
                            </div>
                        </div>
                        
                        <!-- Three-Way Estimate Selector (shown when AI or Hybrid exists) -->
                        <div id="edit-issue-estimate-selector" class="hidden mb-4 p-4 bg-gray-50 rounded-lg border">
                            <h4 class="text-sm font-semibold mb-3">Select Estimate for Planning:</h4>
                            <div class="space-y-2">
                                <label class="flex items-center p-3 border-2 rounded-lg cursor-pointer hover:bg-white transition-colors" id="planning-manual-label">
                                    <input type="radio" name="planning-estimate" value="manual" id="planning-manual" class="w-4 h-4 mr-3">
                                    <div class="flex-1">
                                        <span class="font-medium">⏱️ Manual Estimate:</span>
                                        <span id="planning-manual-hours" class="ml-2 font-bold">-- hours</span>
                                    </div>
                                </label>
                                
                                <label class="flex items-center p-3 border-2 rounded-lg cursor-pointer hover:bg-white transition-colors hidden" id="planning-ai-label">
                                    <input type="radio" name="planning-estimate" value="ai" id="planning-ai" class="w-4 h-4 mr-3">
                                    <div class="flex-1">
                                        <span class="font-medium">🤖 AI Estimate:</span>
                                        <span id="planning-ai-hours" class="ml-2 font-bold">-- hours</span>
                                        <span id="planning-ai-confidence" class="ml-2 text-xs px-2 py-1 rounded bg-blue-200">--</span>
                                    </div>
                                </label>
                                
                                <label class="flex items-center p-3 border-2 rounded-lg cursor-pointer hover:bg-white transition-colors hidden" id="planning-hybrid-label">
                                    <input type="radio" name="planning-estimate" value="hybrid" id="planning-hybrid" class="w-4 h-4 mr-3">
                                    <div class="flex-1">
                                        <span class="font-medium">⚡ Hybrid Estimate:</span>
                                        <span id="planning-hybrid-hours" class="ml-2 font-bold">-- hours</span>
                                        <span id="planning-hybrid-tasks" class="ml-2 text-xs px-2 py-1 rounded bg-green-200">--</span>
                                    </div>
                                </label>
                            </div>
                        </div>
                        
                        <!-- Generate AI Estimate Button -->
                        <button type="button" id="edit-issue-generate-estimate" 
                                class="w-full py-2 px-4 bg-gradient-to-r from-purple-600 to-blue-600 text-white rounded-lg hover:from-purple-700 hover:to-blue-700 text-sm">
                            🤖 Generate AI Estimate
                        </button>
                        
                        <!-- Actual Hours (below all estimate options) -->
                        <div class="mt-4">
                            <label class="block text-sm font-medium text-gray-700 mb-2">Actual Hours <span class="text-xs text-gray-500">(when done)</span></label>
                            <input type="number" id="edit-issue-actual-hours" step="0.5" min="0" max="999"
                                   class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                                   placeholder="e.g., 10">
                        </div>
                        
                        <div id="edit-issue-estimate-warning" class="hidden mt-2 text-xs text-amber-600">
                            ⚠️ <span id="edit-issue-rate-limit-msg">Loading rate limit...</span>
                        </div>
                    </div>
                    
                    <div class="mb-6">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Attachments</label>
                        <div id="edit-issue-attachments-list" class="mb-3 space-y-2">
                            <!-- Attachments will be displayed here -->
                        </div>
                        <input type="file" id="edit-issue-file-input" multiple accept=".pdf,.docx,.doc,.txt,.xlsx,.xls,.png,.jpg,.jpeg" class="hidden">
                        <button type="button" id="edit-issue-upload-btn" 
                                class="w-full border-2 border-dashed border-gray-300 rounded-lg py-3 text-sm text-gray-600 hover:border-blue-400 hover:text-blue-600 transition-colors">
                            <svg class="w-5 h-5 inline mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"/>
                            </svg>
                            Click to upload files
                        </button>
                        <small class="text-gray-500">Supported: PDF, DOCX, TXT, XLSX, images. Max 10MB per file.</small>
                    </div>
                    
                    <div class="flex justify-end gap-3">
                        <button type="button" id="cancelEditIssue"
                                class="px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50">
                            Cancel
                        </button>
                        <button type="submit"
                                class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700">
                            Save Changes
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Edit Action Item Modal -->
        <div id="editActionItemModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
            <div class="bg-white rounded-lg p-6 w-full max-w-2xl max-h-[90vh] overflow-y-auto">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-2xl font-bold">Edit Action Item</h2>
                    <button id="closeEditActionItemModal" class="text-gray-500 hover:text-gray-700">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                        </svg>
                    </button>
                </div>
                
                <form id="editActionItemForm">
                    <input type="hidden" id="edit-action-item-id">
                    
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Title *</label>
                        <input type="text" id="edit-action-item-title" required
                               class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                    </div>
                    
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Description</label>
                        <textarea id="edit-action-item-description" rows="4"
                                  class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"></textarea>
                    </div>
                    
                    <div class="grid grid-cols-2 gap-4 mb-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Assignee</label>
                            <select id="edit-action-item-assignee"
                                    class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                                <option value="">Select Assignee</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Due Date</label>
                            <input type="date" id="edit-action-item-due-date"
                                   class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-3 gap-4 mb-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Priority *</label>
                            <select id="edit-action-item-priority" required
                                    class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                                <option value="low">Low</option>
                                <option value="medium">Medium</option>
                                <option value="high">High</option>
                                <option value="critical">Critical</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Status *</label>
                            <select id="edit-action-item-status" required
                                    class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                                <option value="To Do">To Do</option>
                                <option value="In Progress">In Progress</option>
                                <option value="Blocked">Blocked</option>
                                <option value="Done">Done</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Progress %</label>
                            <input type="number" id="edit-action-item-progress" min="0" max="100" value="0"
                                   class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" readonly
                                   title="Auto-calculated from actual hours / estimated hours">
                        </div>
                    </div>
                    
                    <!-- Actual Hours - Moved up from estimation section -->
                    <div class="mb-4 p-3 bg-blue-50 rounded-lg border border-blue-200">
                        <div class="flex items-center justify-between">
                            <div class="flex-1">
                                <label class="block text-sm font-medium text-gray-700 mb-2">⏱️ Actual Hours Logged</label>
                                <div class="flex items-center gap-2">
                                    <input type="number" id="edit-action-item-actual-hours" step="0.5" min="0" max="999" readonly
                                           class="w-32 px-3 py-2 border border-gray-300 rounded-lg bg-gray-50 focus:ring-2 focus:ring-blue-500"
                                           title="Auto-calculated from time entries">
                                    <span class="text-sm text-gray-600">hours</span>
                                    <span id="edit-action-item-time-count" class="text-xs px-2 py-1 rounded bg-blue-200">0 entries</span>
                                </div>
                            </div>
                            <button type="button" id="edit-action-item-view-timesheet" class="text-sm px-3 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700">
                                📋 View Timesheet
                            </button>
                        </div>
                    </div>
                    
                    <div class="mb-6">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Tags</label>
                        <div id="edit-action-item-selected-tags" class="mb-3">
                            <!-- Selected tags will be displayed here as badges -->
                        </div>
                        <select id="edit-action-item-tags" multiple
                                class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                                style="min-height: 100px;">
                            <option value="" disabled>Loading tags...</option>
                        </select>
                        <small class="text-gray-500">Hold Ctrl/Cmd to select multiple tags</small>
                    </div>
                    
                    <!-- Effort Estimation Section (Phase 1 Enhanced) -->
                    <div class="mb-6 border-t pt-4">
                        <h3 class="text-lg font-semibold mb-3">⏱️ Effort Estimation</h3>
                        
                        <!-- Manual Estimate Input -->
                        <div class="mb-4">
                            <label class="block text-sm font-medium text-gray-700 mb-2">Manual Estimate (hours)</label>
                            <input type="number" id="edit-action-item-estimated-hours" step="0.5" min="0" max="999"
                                   class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                                   placeholder="e.g., 50">
                        </div>
                        
                        <!-- AI Estimate (shown after generation) -->
                        <div id="edit-action-item-ai-estimate-section" class="hidden mb-4">
                            <div class="flex items-center justify-between p-3 bg-blue-50 rounded-lg border border-blue-200">
                                <div>
                                    <span class="text-sm font-medium text-gray-700">AI Estimate:</span>
                                    <span id="edit-action-item-ai-hours" class="text-lg font-bold text-blue-600 ml-2">--</span>
                                    <span class="text-sm text-gray-600">hours</span>
                                    <span id="edit-action-item-ai-confidence" class="ml-2 text-xs px-2 py-1 rounded bg-blue-200">--</span>
                                </div>
                                <button type="button" id="edit-action-item-view-breakdown" class="text-xs px-3 py-1 bg-blue-600 text-white rounded hover:bg-blue-700">
                                    View Breakdown ↗
                                </button>
                            </div>
                        </div>
                        
                        <!-- Hybrid Estimate (shown after selection) -->
                        <div id="edit-action-item-hybrid-estimate-section" class="hidden mb-4">
                            <div class="flex items-center justify-between p-3 bg-green-50 rounded-lg border border-green-200">
                                <div>
                                    <span class="text-sm font-medium text-gray-700">Hybrid Estimate:</span>
                                    <span id="edit-action-item-hybrid-hours" class="text-lg font-bold text-green-600 ml-2">--</span>
                                    <span class="text-sm text-gray-600">hours</span>
                                    <span id="edit-action-item-hybrid-count" class="ml-2 text-xs px-2 py-1 rounded bg-green-200">--</span>
                                </div>
                                <button type="button" id="edit-action-item-view-hybrid-breakdown" class="text-xs px-3 py-1 bg-green-600 text-white rounded hover:bg-green-700">
                                    View Breakdown ↗
                                </button>
                            </div>
                        </div>
                        
                        <!-- Three-Way Estimate Selector (shown when AI or Hybrid exists) -->
                        <div id="edit-action-item-estimate-selector" class="hidden mb-4 p-4 bg-gray-50 rounded-lg border">
                            <h4 class="text-sm font-semibold mb-3">Select Estimate for Planning:</h4>
                            <div class="space-y-2">
                                <label class="flex items-center p-3 border-2 rounded-lg cursor-pointer hover:bg-white transition-colors" id="action-planning-manual-label">
                                    <input type="radio" name="action-planning-estimate" value="manual" id="action-planning-manual" class="w-4 h-4 mr-3">
                                    <div class="flex-1">
                                        <span class="font-medium">⏱️ Manual Estimate:</span>
                                        <span id="action-planning-manual-hours" class="ml-2 font-bold">-- hours</span>
                                    </div>
                                </label>
                                
                                <label class="flex items-center p-3 border-2 rounded-lg cursor-pointer hover:bg-white transition-colors hidden" id="action-planning-ai-label">
                                    <input type="radio" name="action-planning-estimate" value="ai" id="action-planning-ai" class="w-4 h-4 mr-3">
                                    <div class="flex-1">
                                        <span class="font-medium">🤖 AI Estimate:</span>
                                        <span id="action-planning-ai-hours" class="ml-2 font-bold">-- hours</span>
                                        <span id="action-planning-ai-confidence" class="ml-2 text-xs px-2 py-1 rounded bg-blue-200">--</span>
                                    </div>
                                </label>
                                
                                <label class="flex items-center p-3 border-2 rounded-lg cursor-pointer hover:bg-white transition-colors hidden" id="action-planning-hybrid-label">
                                    <input type="radio" name="action-planning-estimate" value="hybrid" id="action-planning-hybrid" class="w-4 h-4 mr-3">
                                    <div class="flex-1">
                                        <span class="font-medium">⚡ Hybrid Estimate:</span>
                                        <span id="action-planning-hybrid-hours" class="ml-2 font-bold">-- hours</span>
                                        <span id="action-planning-hybrid-tasks" class="ml-2 text-xs px-2 py-1 rounded bg-green-200">--</span>
                                    </div>
                                </label>
                            </div>
                        </div>
                        
                        <!-- Generate AI Estimate Button -->
                        <button type="button" id="edit-action-item-generate-estimate" 
                                class="w-full py-2 px-4 bg-gradient-to-r from-purple-600 to-blue-600 text-white rounded-lg hover:from-purple-700 hover:to-blue-700 text-sm">
                            🤖 Generate AI Estimate
                        </button>
                        
                        <div id="edit-action-item-estimate-warning" class="hidden mt-2 text-xs text-amber-600">
                            ⚠️ <span id="edit-action-item-rate-limit-msg">Loading rate limit...</span>
                        </div>
                    </div>
                    
                    <div class="mb-6">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Attachments</label>
                        <div id="edit-action-item-attachments-list" class="mb-3 space-y-2">
                            <!-- Attachments will be displayed here -->
                        </div>
                        <input type="file" id="edit-action-item-file-input" multiple accept=".pdf,.docx,.doc,.txt,.xlsx,.xls,.png,.jpg,.jpeg" class="hidden">
                        <button type="button" id="edit-action-item-upload-btn" 
                                class="w-full border-2 border-dashed border-gray-300 rounded-lg py-3 text-sm text-gray-600 hover:border-blue-400 hover:text-blue-600 transition-colors">
                            <svg class="w-5 h-5 inline mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"/>
                            </svg>
                            Click to upload files
                        </button>
                        <small class="text-gray-500">Supported: PDF, DOCX, TXT, XLSX, images. Max 10MB per file.</small>
                    </div>
                    
                    <div class="flex justify-end gap-3">
                        <button type="button" id="cancelEditActionItem"
                                class="px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50">
                            Cancel
                        </button>
                        <button type="submit"
                                class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700">
                            Save Changes
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Effort Estimate Breakdown Modal -->
        <div id="estimateBreakdownModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
            <div class="bg-white rounded-lg p-6 w-full max-w-3xl max-h-[90vh] overflow-y-auto">
                <div class="flex justify-between items-center mb-4">
                    <h2 id="estimateBreakdownModalTitle" class="text-2xl font-bold">📊 Effort Estimate Breakdown</h2>
                    <button id="closeBreakdownModal" class="text-gray-500 hover:text-gray-700">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                        </svg>
                    </button>
                </div>
                
                <div id="breakdown-content" class="space-y-4">
                    <!-- Content loaded dynamically - used by renderBreakdownModal() for interactive hybrid selector -->
                </div>
            </div>
        </div>

        <!-- Batch Estimate Progress Modal -->
        <div id="batchEstimateProgressModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
            <div class="bg-white rounded-lg p-6 w-full max-w-2xl">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-2xl font-bold">🤖 Generating AI Estimates</h2>
                    <span class="text-sm text-gray-500">Please wait...</span>
                </div>
                
                <div class="space-y-4">
                    <div class="flex justify-between text-sm text-gray-700">
                        <span>Progress: <span id="batch-progress-current">0</span> / <span id="batch-progress-total">0</span></span>
                        <span id="batch-progress-percentage">0%</span>
                    </div>
                    
                    <!-- Progress Bar -->
                    <div class="w-full bg-gray-200 rounded-full h-4 overflow-hidden">
                        <div id="batch-estimate-progress-bar" class="bg-purple-600 h-4 transition-all duration-300" style="width: 0%"></div>
                    </div>
                    
                    <!-- Current Item -->
                    <div class="text-sm text-gray-600">
                        <span class="font-medium">Current:</span> <span id="batch-current-item">--</span>
                    </div>
                    
                    <!-- Status Log (scrollable) -->
                    <div class="border rounded-lg p-3 bg-gray-50 h-48 overflow-y-auto">
                        <div id="batch-status-log" class="space-y-1 text-xs font-mono">
                            <!-- Status messages will appear here -->
                        </div>
                    </div>
                    
                    <!-- Estimated Time Remaining -->
                    <div class="text-xs text-gray-500 text-center">
                        <span id="batch-eta">Calculating time remaining...</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Batch Results Summary Modal -->
        <div id="batchResultsModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
            <div class="bg-white rounded-lg p-6 w-full max-w-3xl max-h-[90vh] overflow-y-auto">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-2xl font-bold">✅ Batch Estimation Complete</h2>
                    <button id="closeBatchResultsModal" class="text-gray-500 hover:text-gray-700">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                        </svg>
                    </button>
                </div>
                
                <!-- Summary Stats -->
                <div class="grid grid-cols-3 gap-4 mb-6">
                    <div class="bg-green-50 p-4 rounded-lg text-center">
                        <div class="text-2xl font-bold text-green-600" id="batch-success-count">0</div>
                        <div class="text-sm text-gray-600">Successful</div>
                    </div>
                    <div class="bg-red-50 p-4 rounded-lg text-center">
                        <div class="text-2xl font-bold text-red-600" id="batch-error-count">0</div>
                        <div class="text-sm text-gray-600">Failed</div>
                    </div>
                    <div class="bg-blue-50 p-4 rounded-lg text-center">
                        <div class="text-2xl font-bold text-blue-600" id="batch-total-hours">0</div>
                        <div class="text-sm text-gray-600">Total Hours</div>
                    </div>
                </div>
                
                <!-- Detailed Results -->
                <div id="batch-results-content" class="space-y-3">
                    <!-- Results will be populated here -->
                </div>
                
                <div class="mt-6 flex justify-end">
                    <button id="closeBatchResultsBtn" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700">
                        Close
                    </button>
                </div>
            </div>
        </div>

        <!-- Bulk Apply Template Modal -->
        <div id="bulkApplyModal" class="hidden fixed inset-0 bg-gray-600 bg-opacity-50 z-50 flex items-center justify-center">
            <div class="bg-white rounded-lg shadow-xl p-6 max-w-md w-full mx-4">
                <h3 class="text-xl font-bold mb-4">Apply Template to Selected Items</h3>
                
                <p class="text-gray-600 mb-4">
                    Applying template to <span id="modalSelectedCount" class="font-semibold">0</span> 
                    <span id="modalEntityType">item(s)</span>
                </p>
                
                <div class="mb-4">
                    <label class="block text-sm font-medium mb-2">Select Template:</label>
                    <select id="bulkTemplateSelect" class="w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                        <option value="">Loading templates...</option>
                    </select>
                </div>
                
                <div id="bulkApplyProgress" class="mb-4 hidden">
                    <div class="text-sm text-gray-600 mb-2">
                        Applying... <span id="progressText">0/0</span>
                    </div>
                    <div class="w-full bg-gray-200 rounded-full h-2">
                        <div id="progressBar" class="bg-blue-600 h-2 rounded-full transition-all" style="width: 0%"></div>
                    </div>
                </div>
                
                <div id="bulkApplyResults" class="mb-4 hidden">
                    <div class="text-sm space-y-1">
                        <div class="text-green-600 font-medium">✅ Successful: <span id="successCount">0</span></div>
                        <div class="text-red-600 font-medium">❌ Failed: <span id="failCount">0</span></div>
                    </div>
                </div>
                
                <div class="flex gap-2 justify-end">
                    <button id="cancelBulkApply" class="px-4 py-2 text-gray-600 hover:bg-gray-100 rounded-lg transition-colors">
                        Cancel
                    </button>
                    <button id="confirmBulkApply" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors">
                        Apply to All
                    </button>
                </div>
            </div>
        </div>

        <script src="header.js?v=4"></script>
        <script src="auth.js?v=10"></script>
        <style>
            .line-clamp-5 {
                display: -webkit-box;
                -webkit-line-clamp: 5;
                -webkit-box-orient: vertical;
                overflow: hidden;
            }
            
            /* Due Date Badge Styles */
            .due-date-badge {
                display: inline-flex;
                align-items: center;
                gap: 6px;
                padding: 6px 10px;
                border-radius: 6px;
                font-size: 13px;
                font-weight: 500;
                margin-top: 8px;
                border-left: 3px solid;
            }
            
            .due-date-badge i {
                font-size: 12px;
            }
            
            .due-date-badge.overdue {
                background: #fee2e2;
                color: #dc2626;
                border-left-color: #dc2626;
            }
            
            .due-date-badge.today {
                background: #fef3c7;
                color: #d97706;
                border-left-color: #d97706;
            }
            
            .due-date-badge.soon {
                background: #fef3c7;
                color: #f59e0b;
                border-left-color: #f59e0b;
            }
            
            .due-date-badge.future {
                background: #dbeafe;
                color: #2563eb;
                border-left-color: #2563eb;
            }
            
            .due-date-badge.none {
                background: #f3f4f6;
                color: #6b7280;
                border-left-color: transparent;
            }
            
            /* Done item badges */
            .due-date-badge.on-time {
                background: #d1fae5;
                color: #059669;
                border-left-color: #059669;
            }
            
            .due-date-badge.early {
                background: #dbeafe;
                color: #2563eb;
                border-left-color: #2563eb;
            }
            
            .due-date-badge.late {
                background: #fee2e2;
                color: #dc2626;
                border-left-color: #dc2626;
            }
            
            .due-date-badge.completed {
                background: #e5e7eb;
                color: #4b5563;
                border-left-color: #4b5563;
            }
            
            /* Mobile responsive */
            @media (max-width: 768px) {
                .due-date-badge {
                    font-size: 11px;
                    padding: 4px 8px;
                    gap: 4px;
                }
            }
        </style>

        <!-- Timesheet Modal -->
        <div id="timesheetModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
            <div class="bg-white rounded-lg p-6 w-full max-w-4xl max-h-[90vh] overflow-y-auto">
                <div class="flex justify-between items-center mb-4">
                    <h2 id="timesheetModalTitle" class="text-2xl font-bold">⏱️ Timesheet Entries</h2>
                    <button id="closeTimesheetModal" class="text-gray-500 hover:text-gray-700 text-2xl">&times;</button>
                </div>
                
                <!-- Quick Log Time Form -->
                <div class="mb-4 p-4 bg-blue-50 rounded-lg border border-blue-200">
                    <h3 class="text-lg font-semibold mb-3">➕ Log New Time Entry</h3>
                    <div class="grid grid-cols-3 gap-3">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Hours *</label>
                            <input type="number" id="quick-log-hours" step="0.5" min="0.5" max="24" required
                                   class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                                   placeholder="e.g., 2.5">
                        </div>
                        <div class="col-span-2">
                            <label class="block text-sm font-medium text-gray-700 mb-1">Notes (optional)</label>
                            <input type="text" id="quick-log-notes"
                                   class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                                   placeholder="What did you work on?">
                        </div>
                    </div>
                    <button type="button" id="submit-quick-log" class="mt-3 w-full py-2 px-4 bg-blue-600 text-white rounded-lg hover:bg-blue-700">
                        ⏱️ Log Time
                    </button>
                </div>
                
                <!-- Time Entries Table -->
                <div class="mb-4">
                    <h3 class="text-lg font-semibold mb-2">Time Log History</h3>
                    <div id="timesheet-entries-container" class="overflow-x-auto">
                        <table class="w-full text-sm">
                            <thead class="bg-gray-100 border-b">
                                <tr>
                                    <th class="px-4 py-2 text-left">Date & Time</th>
                                    <th class="px-4 py-2 text-left">Logged By</th>
                                    <th class="px-4 py-2 text-right">Hours</th>
                                    <th class="px-4 py-2 text-left">Notes</th>
                                    <th class="px-4 py-2 text-center">Actions</th>
                                </tr>
                            </thead>
                            <tbody id="timesheet-entries-tbody">
                                <!-- Entries populated by JavaScript -->
                            </tbody>
                            <tfoot class="bg-gray-50 border-t-2 border-gray-300 font-bold">
                                <tr>
                                    <td colspan="2" class="px-4 py-3 text-right">Total Hours:</td>
                                    <td class="px-4 py-3 text-right" id="timesheet-total-hours">0.00</td>
                                    <td colspan="2"></td>
                                </tr>
                            </tfoot>
                        </table>
                    </div>
                </div>
                
                <div class="flex justify-end">
                    <button id="closeTimesheetModalBtn" class="px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50">
                        Close
                    </button>
                </div>
            </div>
        </div>

        <!-- Quick Log Time Modal -->
        <div id="quickLogModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
            <div class="bg-white rounded-lg p-6 w-full max-w-md">
                <div class="flex justify-between items-center mb-4">
                    <h2 id="quickLogModalTitle" class="text-xl font-bold">⏱️ Quick Log Time</h2>
                    <button id="closeQuickLogModal" class="text-gray-500 hover:text-gray-700 text-2xl">&times;</button>
                </div>
                
                <div class="mb-4">
                    <label class="block text-sm font-medium mb-1">Hours Logged <span class="text-red-500">*</span></label>
                    <input type="number" 
                           id="quick-log-hours" 
                           step="0.25" 
                           min="0.25" 
                           max="999" 
                           placeholder="e.g., 2.5"
                           class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                </div>
                
                <div class="mb-4">
                    <label class="block text-sm font-medium mb-1">Notes (optional)</label>
                    <textarea id="quick-log-notes" 
                              rows="3" 
                              placeholder="What did you work on?"
                              class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"></textarea>
                </div>
                
                <div class="flex gap-2">
                    <button id="cancelQuickLog" class="flex-1 px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50">
                        Cancel
                    </button>
                    <button id="submitQuickLog" class="flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700">
                        ⏱️ Log Time
                    </button>
                </div>
            </div>
        </div>

        <script src="comments.js?v=3"></script>
        <script src="js/checklist-completion-warning.js"></script>
        <script src="js/timesheet.js"></script>
        <script src="app.js?v=32"></script>
        <script src="js/project-management.js"></script>
    </body>
</html>

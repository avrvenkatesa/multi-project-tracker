# PDF Export Testing Guide

## Overview
This guide covers testing the PDF export functionality for checklists. The feature allows users to export checklists as professional PDF reports with multiple format options.

## Test Setup
1. **Prerequisites:**
   - Server running on port 5000
   - Authenticated user account
   - At least one checklist with responses
   - Some completed items for testing "completed-only" format

## Manual Test Cases

### Test Case 1: Basic PDF Export (Full Format)
**Steps:**
1. Navigate to a checklist detail page (checklist-fill.html?id=XXX)
2. Click the "Export PDF" button (purple button in header)
3. Verify modal opens with title "üìÑ Export Checklist as PDF"
4. Keep default "Full Report" option selected
5. Keep all checkboxes checked (Comments, Charts, Metadata)
6. Click "Download PDF" button

**Expected Result:**
- PDF downloads with filename format: `{checklist_id}_{timestamp}.pdf`
- PDF contains:
  - Checklist title and status badge
  - Complete metadata section
  - Progress chart (doughnut chart)
  - All checklist sections and items
  - Checkbox indicators (‚òë for completed, ‚òê for incomplete)
  - Response values for completed items
  - Comment indicators
  - Sign-off section (with signatures if signed, or empty placeholders)
  - Page numbers on all pages

### Test Case 2: Summary Format Export
**Steps:**
1. Open export modal
2. Select "Summary" radio option
3. Keep all checkboxes checked
4. Click "Download PDF"

**Expected Result:**
- PDF downloads successfully
- Contains key information without detailed comments
- Chart and metadata included
- All items shown (not filtered)

### Test Case 3: Completed Items Only
**Steps:**
1. Ensure checklist has both completed and incomplete items
2. Open export modal
3. Select "Completed Items Only" radio option
4. Click "Download PDF"

**Expected Result:**
- PDF contains only items with response values
- Incomplete items are excluded
- Progress chart shows accurate completion percentage

### Test Case 4: Export Without Comments
**Steps:**
1. Open export modal
2. Keep "Full Report" selected
3. Uncheck "Comments" checkbox
4. Click "Download PDF"

**Expected Result:**
- PDF exports without comment indicators
- All other sections remain intact

### Test Case 5: Export Without Charts
**Steps:**
1. Open export modal
2. Uncheck "Progress Charts" checkbox
3. Click "Download PDF"

**Expected Result:**
- PDF exports without the progress doughnut chart
- All other sections present

### Test Case 6: Export Without Metadata
**Steps:**
1. Open export modal
2. Uncheck "Metadata & Details" checkbox
3. Click "Download PDF"

**Expected Result:**
- PDF exports without the metadata information section
- Checklist content starts immediately after header

### Test Case 7: Minimal Export
**Steps:**
1. Open export modal
2. Select "Summary" format
3. Uncheck all optional checkboxes
4. Click "Download PDF"

**Expected Result:**
- Minimal PDF with just checklist title, status, and items
- No charts, metadata, or comments

### Test Case 8: AI-Generated Checklist Export
**Steps:**
1. Generate a checklist from an issue or action item using AI
2. Fill in some responses
3. Export as "Full Report"

**Expected Result:**
- PDF metadata includes "Generated By: AI from Issue/Action Item"
- Source information displayed in metadata
- All AI-generated sections and items properly formatted

### Test Case 9: Modal Controls
**Steps:**
1. Open export modal
2. Test close button (X)
3. Reopen modal
4. Test Cancel button
5. Reopen modal
6. Click outside modal background

**Expected Result:**
- All three methods close the modal successfully
- Modal state resets each time

### Test Case 10: Error Handling
**Steps:**
1. Log out from another tab/window
2. Try to export PDF
3. OR: Manually try to access `/api/checklists/999999/export/pdf`

**Expected Result:**
- Authentication error: 401 Unauthorized
- User redirected to login or shown error toast
- Invalid checklist: 404 error with appropriate message

## Automated Test Commands

Run the automated test script:
```bash
node test-pdf-export.js
```

## API Testing with cURL

### Full Export
```bash
curl -X GET "http://localhost:5000/api/checklists/1/export/pdf?format=full&include_comments=true&include_charts=true&include_metadata=true" \
  --cookie "token=YOUR_JWT_TOKEN" \
  -o checklist_full.pdf
```

### Summary Export
```bash
curl -X GET "http://localhost:5000/api/checklists/1/export/pdf?format=summary" \
  --cookie "token=YOUR_JWT_TOKEN" \
  -o checklist_summary.pdf
```

### Completed Only
```bash
curl -X GET "http://localhost:5000/api/checklists/1/export/pdf?format=completed-only&include_charts=true" \
  --cookie "token=YOUR_JWT_TOKEN" \
  -o checklist_completed.pdf
```

## Feature Verification Checklist

- [ ] Export button visible on checklist detail page
- [ ] Modal opens with proper styling and options
- [ ] All three format options work correctly
- [ ] Checkbox options properly include/exclude content
- [ ] PDF filename uses checklist ID and timestamp
- [ ] PDF contains all expected sections based on options
- [ ] Progress chart renders correctly (when included)
- [ ] Sign-off section shows existing signatures or placeholders
- [ ] Page numbers appear on all pages
- [ ] Loading state shows during PDF generation
- [ ] Success toast appears after download
- [ ] Error handling works for invalid requests
- [ ] Modal closes properly with all methods
- [ ] AI-generated checklists export with source info

## Known Limitations (Phase 2b)
- Chart generation may fail silently (fallback text shown)
- Very large checklists may take time to generate
- No progress indicator during generation (just disabled button)
- No export history or batch export capability

## Performance Notes
- Small checklists (<20 items): ~1-2 seconds
- Medium checklists (20-100 items): ~2-5 seconds
- Large checklists (100+ items): ~5-10 seconds
- Chart generation adds ~500ms-1s to export time

## Troubleshooting

### PDF Not Downloading
1. Check browser console for errors
2. Verify authentication (check network tab for 401 errors)
3. Confirm checklist ID is valid
4. Check server logs for PDF generation errors

### Missing Content in PDF
1. Verify checkboxes in export modal were checked
2. Check if checklist has the expected data
3. For charts: Verify chartjs-node-canvas is installed
4. Check server logs for warnings

### Styling Issues in PDF
1. PDFKit uses its own styling (not CSS)
2. Custom fonts require additional configuration
3. Images must be properly encoded

## Success Criteria
‚úÖ All 10 manual test cases pass
‚úÖ PDF downloads successfully for all format options
‚úÖ All include/exclude options work correctly
‚úÖ Error handling prevents crashes
‚úÖ UI provides clear feedback during export
‚úÖ Generated PDFs are professional and readable

(async () => {
  const RESPONSE_ID_1 = 806;  // "Identify stakeholders..."
  const RESPONSE_ID_2 = 807;  // "Gather existing documentation..."
  
  console.log('ğŸ§ª TESTING DEPENDENCY APIs (Corrected)\n');
  console.log(`Response ${RESPONSE_ID_2} will depend on Response ${RESPONSE_ID_1}\n`);
  
  try {
    // Test 1: Add dependency
    console.log('â”â”â” Test 1: Add Dependency â”â”â”');
    const addResult = await fetch(`/api/checklist-items/${RESPONSE_ID_2}/dependencies`, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      credentials: 'include',
      body: JSON.stringify({ dependsOnItemId: RESPONSE_ID_1 })
    }).then(r => r.json());
    console.log('Result:', addResult);
    console.log(addResult.success ? 'âœ… PASS' : 'âŒ FAIL');
    console.log('');
    
    if (!addResult.success) {
      console.error('âŒ Cannot continue - add dependency failed');
      return;
    }
    
    // Test 2: Get dependencies
    console.log('â”â”â” Test 2: Get Dependencies â”â”â”');
    const deps = await fetch(`/api/checklist-items/${RESPONSE_ID_2}/dependencies`)
      .then(r => r.json());
    console.log('Count:', deps.count);
    console.log('Dependencies:', deps.dependencies);
    console.log(deps.count > 0 ? 'âœ… PASS' : 'âŒ FAIL');
    console.log('');
    
    // Test 3: Check blocking status
    console.log('â”â”â” Test 3: Blocking Status â”â”â”');
    const blocking = await fetch(`/api/checklist-items/${RESPONSE_ID_2}/blocking-status`)
      .then(r => r.json());
    console.log('Is Blocked:', blocking.isBlocked);
    console.log('Blocked By:', blocking.blockedBy);
    console.log('Total Deps:', blocking.totalDependencies);
    console.log('Completed:', blocking.completedDependencies);
    console.log(blocking.isBlocked === true ? 'âœ… PASS' : 'âŒ FAIL');
    console.log('');
    
    // Test 4: Get dependent items
    console.log('â”â”â” Test 4: Dependent Items (Reverse Lookup) â”â”â”');
    const dependents = await fetch(`/api/checklist-items/${RESPONSE_ID_1}/dependent-items`)
      .then(r => r.json());
    console.log('Count:', dependents.count);
    console.log('Dependent Items:', dependents.dependentItems);
    console.log(dependents.count > 0 ? 'âœ… PASS' : 'âŒ FAIL');
    console.log('');
    
    // Test 5: Circular dependency prevention
    console.log('â”â”â” Test 5: Circular Dependency (Should Fail) â”â”â”');
    const circular = await fetch(`/api/checklist-items/${RESPONSE_ID_1}/dependencies`, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      credentials: 'include',
      body: JSON.stringify({ dependsOnItemId: RESPONSE_ID_2 })
    }).then(r => r.json());
    console.log('Result:', circular);
    const circularBlocked = circular.error && (
      circular.error.includes('circular') || 
      circular.error.includes('Circular')
    );
    console.log(circularBlocked ? 'âœ… PASS (correctly prevented)' : 'âŒ FAIL (should have been blocked)');
    console.log('');
    
    // Test 6: Remove dependency
    console.log('â”â”â” Test 6: Remove Dependency â”â”â”');
    const depId = deps.dependencies[0]?.dependency_id;
    if (depId) {
      const removeResult = await fetch(`/api/dependencies/${depId}`, {
        method: 'DELETE',
        credentials: 'include'
      }).then(r => r.json());
      console.log('Result:', removeResult);
      console.log(removeResult.success ? 'âœ… PASS' : 'âŒ FAIL');
    } else {
      console.log('âš ï¸ No dependency ID found to remove');
    }
    
    console.log('\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”');
    console.log('ğŸ‰ All API tests complete!');
    console.log('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”');
    
  } catch (error) {
    console.error('âŒ Test suite failed:', error);
  }
})();
```

---

## **What to Watch:**

**Server Console:** Should show enhanced logging like:
```
â• Adding dependency: Item 807 depends on Item 806
SQL query result: [...]
âœ… Dependency created: 1
```

---

## **Expected Results:**
```
Test 1: âœ… PASS
Test 2: âœ… PASS
Test 3: âœ… PASS (isBlocked: true)
Test 4: âœ… PASS
Test 5: âœ… PASS (circular prevented)
Test 6: âœ… PASS
 ### **PROMPT 4: Create Test Script**

  Create test file: tests/test-resource-parser.js

  This tests resource extraction from various document formats.

  const resourceParser = require('../services/resource-parser');

  async function runTests() {
    console.log('=== RESOURCE PARSER TESTS ===\n');

    // Test Document 1: Table Format
    const tableDoc = `
  Resource Allocation Table:

  | Task Component       | Resource      | Role               | Effort   |
  |----------------------|---------------|--------------------|----------|
  | API Development      | John Doe      | Senior Developer   | 80 hours |
  | Database Design      | Jane Smith    | Database Architect | 40h      |
  | Infrastructure Setup | Mike Chen     | DevOps Engineer    | 5 days   |
  | Testing & QA         | Bob Wilson    | QA Lead            | 60 hours |
  | Documentation        | Sarah Johnson | Technical Writer   | 3 days   |
  | `;                   |               |                    |          |

    console.log('Test 1: Parse Resource Table');
    console.log('─────────────────────────────');
    const tableResources = resourceParser.parseResourceTable(tableDoc);
    console.log(Extracted ${tableResources.length} resources from table);
    tableResources.forEach(r => {
      console.log(  ✓ ${r.task}: ${r.name} (${r.role}) - ${r.effort} ${r.unit});
    });
    console.log('');

    // Test Document 2: List Format
    const listDoc = `
  Team Assignments:

  - Discovery Phase: Sarah Johnson (Project Manager) - 40 hours
  - Architecture Design: Mike Chen (Solution Architect) - 60h
  - Implementation: Dev Team (3 developers) - 240 hours total
  - Code Review: John Doe (Tech Lead) - 2 days
  `;

  - console.log('Test 2: Parse Resource List');
  console.log('────────────────────────────');
  const listResources = resourceParser.parseResourceList(listDoc);
  console.log(Extracted ${listResources.length} resources from list);
  listResources.forEach(r => {
    console.log(  ✓ ${r.task}: ${r.name} (${r.role}) - ${r.effort} ${r.unit});
  });
  console.log('');

  - // Test Document 3: Mixed Format (AD Migration style)
  const mixedDoc = `
  AD Migration - Resource Allocation

  Phase 0: Prerequisites
  - Backup Validation: Sultan (Infrastructure Manager) - 5.2 hours
  - NTDS.DIT Extraction: Srihari S (Systems Engineer) - 2.3 hours

  Phase 1: Discovery (Weeks 2-3)
  Infrastructure assessment will be handled by Moshik V (Cloud Architect) - 40 hours
  Domain analysis: Sultan and Srihari - 30 hours combined

  | Activity                 | Sultan | Srihari S | Moshik V | Total |
  |--------------------------|--------|-----------|----------|-------|
  | Functional Level Upgrade | 8.6h   | 3.0h      | 2.0h     | 13.6h |
  | Replication Setup        | 12.0h  | 8.0h      | -        | 20.0h |
  | `;                       |        |           |          |       |

    console.log('Test 3: Parse Mixed Format (AD Migration)');
    console.log('──────────────────────────────────────────');
    const mixedResources = await resourceParser.parseResources(mixedDoc, {});
    console.log(Extracted ${mixedResources.length} total resources);
    mixedResources.forEach(r => {
      console.log(  ✓ ${r.task}: ${r.name} (${r.role || 'N/A'}) - ${r.effort} ${r.unit});
    });
    console.log('');

    // Test 4: Fuzzy User Matching
    console.log('Test 4: Fuzzy User Matching');
    console.log('────────────────────────────');

    const mockUsers = [
      { id: 1, username: 'john.doe', full_name: 'John Doe' },
      { id: 2, username: 'jane.smith', full_name: 'Jane Smith' },
      { id: 3, username: 'sultan.k', full_name: 'Sultan Khan' }
    ];

    const testResources = [
      { name: 'John Doe', task: 'API Dev' },
      { name: 'J. Smith', task: 'DB Design' }, // Partial match
      { name: 'Sultan', task: 'Infrastructure' }, // First name only
      { name: 'Unknown Person', task: 'Testing' } // No match
    ];

    const matched = resourceParser.matchResourcesToUsers(testResources, mockUsers);
    matched.forEach(r => {
      if (r.userId) {
        console.log(  ✓ "${r.name}" → ${mockUsers.find(u => u.id === r.userId).full_name} (confidence: ${r.matchConfidence}));
      } else {
        console.log(  ⚠️  "${r.name}" → NO MATCH (needs review));
      }
    });
    console.log('');

    // Test 5: Deduplication
    console.log('Test 5: Resource Deduplication');
    console.log('───────────────────────────────');

    const duplicates = [
      { name: 'John Doe', task: 'API Development', effort: 40 },
      { name: 'John Doe', task: 'API Development', effort: 40 }, // Duplicate
      { name: 'Jane Smith', task: 'Testing', effort: 20 },
      { name: 'John Doe', task: 'Code Review', effort: 10 } // Different task, not duplicate
    ];

    const unique = resourceParser.deduplicateResources(duplicates);
    console.log(  Original: ${duplicates.length} resources);
    console.log(  After deduplication: ${unique.length} resources);
    console.log('');

    console.log('═══════════════════════════════════════');
    console.log('✅ All resource parser tests completed!');
    console.log('═══════════════════════════════════════');
  }

  runTests()
    .catch(error => {
      console.error('Test error:', error);
      process.exit(1);
    })
    .finally(() => {
      process.exit(0);
    });

  Run with: node tests/test-resource-parser.js

~/workspace$ node tests/test-multi-document-workflow.js
âš ï¸  resource-parser service not available - resource assignment will be skipped
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘  MULTI-DOCUMENT WORKFLOW - INTEGRATION TEST          â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Setup: Creating test project...
âœ“ Created project 17

Running multi-document analyzer...

â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘   MULTI-DOCUMENT PROJECT IMPORT STARTING           â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ“ Project ID: 17
ğŸ“„ Documents: 3
ğŸ“… Start Date: 2025-01-06

Step 1/7: Combining document text...
âœ“ Combined 1403 characters

Step 2/7: Detecting workstreams...
ğŸ” Analyzing document for workstreams...
Error detecting workstreams: TypeError: Cannot read properties of undefined (reading 'projectName')
    at buildWorkstreamDetectionPrompt (/home/runner/workspace/services/workstream-detector.js:118:22)
    at Object.detectWorkstreams (/home/runner/workspace/services/workstream-detector.js:35:20)
    at MultiDocumentAnalyzer.analyzeMultipleDocuments (/home/runner/workspace/services/multi-document-analyzer.js:103:63)
    at runWorkflowTest (/home/runner/workspace/tests/test-multi-document-workflow.js:100:48)
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
âŒ Multi-document import failed: Cannot read properties of undefined (reading 'projectName')
Failed to store import failure metadata: column "imported_by" of relation "project_imports" does not exist

â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘  TEST RESULTS                                        â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Overall Success: âŒ FAIL

Documents Processed: 3
  Expected: 3
  Status: âœ…

Workstreams Created: 0
  Expected: 3 (Phase 0, 1, 2)
  Status: âŒ

Issues Created: 0
  Expected: 3+
  Status: âŒ

Timeline Extracted:
  Phases: 0 (expected: 3)
  Milestones: 0 (expected: 3)
  Status: âš ï¸ 

Dependencies Created: 0
  Expected: 1+ (Phase 1 â†’ Phase 2)
  Status: âš ï¸ 

Resource Assignments: 0
  Expected: 2+ (Sultan, Srihari)
  Status: âš ï¸ 

Checklists: 0
  Items: 0
  Status: âš ï¸ 

AI Cost: $0.0000
  Expected: < $0.50
  Status: âœ…

Errors: 1
  Expected: 0
  Status: âŒ
    âŒ Cannot read properties of undefined (reading 'projectName')

Warnings: 0

â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘  âš ï¸  SOME TESTS FAILED                               â•‘
â•‘  Review the results above                            â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Cleaning up test data...
âœ“ Cleanup complete

ğŸ‰ Workflow test completed!
~/workspace$ node tests/test-multi-document-workflow.js
âš ï¸  resource-parser service not available - resource assignment will be skipped
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘  MULTI-DOCUMENT WORKFLOW - INTEGRATION TEST          â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Setup: Creating test project...
âœ“ Created project 18

Running multi-document analyzer...

â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘   MULTI-DOCUMENT PROJECT IMPORT STARTING           â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ“ Project ID: 18
ğŸ“„ Documents: 3
ğŸ“… Start Date: 2025-01-06

Step 1/7: Combining document text...
âœ“ Combined 1403 characters

Step 2/7: Detecting workstreams...
ğŸ” Analyzing document for workstreams...
ğŸ“„ Raw AI response length: 2273
ğŸ”¢ Tokens used: 1392
âœ… Identified 3 workstreams
âœ“ Found 3 workstreams
  1. Prerequisites Validation and Approval (unknown complexity)
  2. Infrastructure Discovery and Analysis (unknown complexity)
  3. Migration Execution and Deployment (unknown complexity)

Step 3/7: Creating issues from workstreams...
  âœ“ Created issue #115: Prerequisites Validation and Approval
  âœ“ Created issue #116: Infrastructure Discovery and Analysis
  âœ“ Created issue #117: Migration Execution and Deployment
âœ“ Created 3 issues

Step 4/7: Extracting timeline...
âœ“ Extracted 3 phases, 3 milestones

Step 5/7: Creating dependencies...
âš ï¸  Dependency mapping failed: this.dependencyMapper.mapDependencies is not a function

Step 6/7: Parsing resource assignments...
âš ï¸  Resource parser not available - skipping

Step 7/7: Generating checklists...
  Processing 3 of 3 workstreams
ğŸ¤– Generating standalone checklists from document (1403 chars)
[AI] Starting document analysis (provider: OpenAI GPT-4o)
[AI] Document analysis complete, parsing response...
=== AI RESPONSE DEBUG ===
Result keys: [ 'checklists' ]
Checklists count: 4
Checklist: "Phase 0: Prerequisites"
  Section: "Backup Validation" - 3 items
  Section: "Initial Setup" - 3 items
  âœ… Valid: 6 total items
Checklist: "Phase 1: Discovery"
  Section: "Infrastructure Assessment" - 3 items
  âœ… Valid: 3 total items
Checklist: "Phase 2: Execution"
  Section: "Deployment and Setup" - 3 items
  âœ… Valid: 3 total items
Checklist: "Project Milestones"
  Section: "Milestone Tracking" - 3 items
  âœ… Valid: 3 total items
âœ… Generated 4 valid checklists with 15 total items
ğŸ¤– Generating standalone checklists from document (1403 chars)
[AI] Starting document analysis (provider: OpenAI GPT-4o)
[AI] Document analysis complete, parsing response...
=== AI RESPONSE DEBUG ===
Result keys: [ 'checklists' ]
Checklists count: 4
Checklist: "Phase 0: Prerequisites"
  Section: "Backup Validation" - 3 items
  Section: "NTDS.DIT Extraction" - 2 items
  Section: "Gate 1 Approval" - 1 items
  âœ… Valid: 6 total items
Checklist: "Phase 1: Discovery"
  Section: "Infrastructure Assessment" - 1 items
  Section: "Domain Analysis" - 1 items
  Section: "Migration Planning" - 1 items
  âœ… Valid: 3 total items
Checklist: "Phase 2: Execution"
  Section: "AWS Deployment" - 1 items
  Section: "Replication Setup" - 1 items
  Section: "Functional Level Upgrade" - 1 items
  âœ… Valid: 3 total items
Checklist: "Milestones and Dependencies"
  Section: "Milestones" - 3 items
  Section: "Dependencies" - 1 items
  âœ… Valid: 4 total items
âœ… Generated 4 valid checklists with 16 total items
ğŸ¤– Generating standalone checklists from document (1403 chars)
[AI] Starting document analysis (provider: OpenAI GPT-4o)
[AI] Document analysis complete, parsing response...
=== AI RESPONSE DEBUG ===
Result keys: [ 'checklists' ]
Checklists count: 3
Checklist: "Phase 0: Prerequisites"
  Section: "Backup and Validation" - 4 items
  Section: "NTDS.DIT Extraction" - 1 items
  Section: "Gate 1 Approval" - 3 items
  âœ… Valid: 8 total items
Checklist: "Phase 1: Discovery"
  Section: "Infrastructure Assessment" - 1 items
  Section: "Domain Analysis" - 1 items
  Section: "Migration Planning" - 1 items
  âœ… Valid: 3 total items
Checklist: "Phase 2: Execution"
  Section: "AWS Deployment" - 1 items
  Section: "Replication Setup" - 1 items
  Section: "Functional Level Upgrade" - 1 items
  âœ… Valid: 3 total items
âœ… Generated 3 valid checklists with 14 total items
âœ“ Generated 3 checklists with 45 items

âŒ Multi-document import failed: invalid input syntax for type numeric: "0[object Object]"

â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘  TEST RESULTS                                        â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Overall Success: âŒ FAIL

Documents Processed: 3
  Expected: 3
  Status: âœ…

Workstreams Created: 3
  Expected: 3 (Phase 0, 1, 2)
  Status: âœ…

Issues Created: 3
  Expected: 3+
  Status: âœ…

Timeline Extracted:
  Phases: 3 (expected: 3)
  Milestones: 3 (expected: 3)
  Status: âœ…

Dependencies Created: 0
  Expected: 1+ (Phase 1 â†’ Phase 2)
  Status: âš ï¸ 

Resource Assignments: 0
  Expected: 2+ (Sultan, Srihari)
  Status: âš ï¸ 

Checklists: 3
  Items: 45
  Status: âœ…


âŒ Workflow test failed: TypeError: result.totalCost.toFixed is not a function
    at runWorkflowTest (/home/runner/workspace/tests/test-multi-document-workflow.js:154:49)
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
TypeError: result.totalCost.toFixed is not a function
    at runWorkflowTest (/home/runner/workspace/tests/test-multi-document-workflow.js:154:49)
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)

Cleaning up test data...
âœ“ Cleanup complete

ğŸ’¥ Workflow test failed!
TypeError: result.totalCost.toFixed is not a function
    at runWorkflowTest (/home/runner/workspace/tests/test-multi-document-workflow.js:154:49)
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
~/workspace$ 